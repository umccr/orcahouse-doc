{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.9.2", "generated_at": "2025-04-09T12:57:17.964626Z", "invocation_id": "bb17ef55-a7a1-40f5-8be9-e4712bd2e550", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.764201Z", "completed_at": "2025-04-09T12:57:17.766245Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.766466Z", "completed_at": "2025-04-09T12:57:17.766474Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.013630151748657227, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.spreadsheet_google_lims", "compiled": true, "compiled_code": "\n\nwith cutoff as (\n\n    select coalesce(max(load_datetime), '1900-01-01') as ldts from \"orcavault\".\"psa\".\"spreadsheet_google_lims\"\n\n),\n\nsource as (\n\n    select\n        *\n    from\n        \"orcavault\".\"tsa\".\"spreadsheet_google_lims\"\n\n    \n\n    where cast(\"timestamp\" as timestamptz) + time '11:00' > ( select ldts from cutoff )\n\n    \n\n),\n\ncleaned as (\n\n    select\n        trim(regexp_replace(illumina_id, E'[\\\\n\\\\r]+', '', 'g')) as illumina_id,\n        trim(regexp_replace(run, E'[\\\\n\\\\r]+', '', 'g')) as run,\n        trim(regexp_replace(\"timestamp\", E'[\\\\n\\\\r]+', '', 'g')) as \"timestamp\",\n        trim(regexp_replace(subject_id, E'[\\\\n\\\\r]+', '', 'g')) as subject_id,\n        trim(regexp_replace(sample_id, E'[\\\\n\\\\r]+', '', 'g')) as sample_id,\n        trim(regexp_replace(library_id, E'[\\\\n\\\\r]+', '', 'g')) as library_id,\n        trim(regexp_replace(external_subject_id, E'[\\\\n\\\\r]+', '', 'g')) as external_subject_id,\n        trim(regexp_replace(external_sample_id, E'[\\\\n\\\\r]+', '', 'g')) as external_sample_id,\n        trim(regexp_replace(external_library_id, E'[\\\\n\\\\r]+', '', 'g')) as external_library_id,\n        trim(regexp_replace(sample_name, E'[\\\\n\\\\r]+', '', 'g')) as sample_name,\n        trim(regexp_replace(project_owner, E'[\\\\n\\\\r]+', '', 'g')) as project_owner,\n        trim(regexp_replace(project_name, E'[\\\\n\\\\r]+', '', 'g')) as project_name,\n        trim(regexp_replace(project_custodian, E'[\\\\n\\\\r]+', '', 'g')) as project_custodian,\n        trim(regexp_replace(type, E'[\\\\n\\\\r]+', '', 'g')) as type,\n        trim(regexp_replace(assay, E'[\\\\n\\\\r]+', '', 'g')) as assay,\n        trim(regexp_replace(override_cycles, E'[\\\\n\\\\r]+', '', 'g')) as override_cycles,\n        trim(regexp_replace(phenotype, E'[\\\\n\\\\r]+', '', 'g')) as phenotype,\n        trim(regexp_replace(source, E'[\\\\n\\\\r]+', '', 'g')) as source,\n        trim(regexp_replace(quality, E'[\\\\n\\\\r]+', '', 'g')) as quality,\n        trim(regexp_replace(topup, E'[\\\\n\\\\r]+', '', 'g')) as topup,\n        trim(regexp_replace(secondary_analysis, E'[\\\\n\\\\r]+', '', 'g')) as secondary_analysis,\n        trim(regexp_replace(workflow, E'[\\\\n\\\\r]+', '', 'g')) as workflow,\n        trim(regexp_replace(tags, E'[\\\\n\\\\r]+', '', 'g')) as tags,\n        trim(regexp_replace(fastq, E'[\\\\n\\\\r]+', '', 'g')) as fastq,\n        trim(regexp_replace(number_fastqs, E'[\\\\n\\\\r]+', '', 'g')) as number_fastqs,\n        trim(regexp_replace(results, E'[\\\\n\\\\r]+', '', 'g')) as results,\n        trim(regexp_replace(trello, E'[\\\\n\\\\r]+', '', 'g')) as trello,\n        trim(regexp_replace(notes, E'[\\\\n\\\\r]+', '', 'g')) as notes,\n        trim(regexp_replace(todo, E'[\\\\n\\\\r]+', '', 'g')) as todo,\n        trim(regexp_replace(sheet_name, E'[\\\\n\\\\r]+', '', 'g')) as sheet_name\n    from\n        source\n    where\n        coalesce\n        (\n            nullif(illumina_id, ''),\n            nullif(run, ''),\n            nullif(\"timestamp\", ''),\n            nullif(subject_id, ''),\n            nullif(sample_id, ''),\n            nullif(library_id, ''),\n            nullif(external_subject_id, ''),\n            nullif(external_sample_id, ''),\n            nullif(external_library_id, ''),\n            nullif(sample_name, ''),\n            nullif(project_owner, ''),\n            nullif(project_name, ''),\n            nullif(project_custodian, ''),\n            nullif(type, ''),\n            nullif(assay, ''),\n            nullif(override_cycles, ''),\n            nullif(phenotype, ''),\n            nullif(source, ''),\n            nullif(quality, ''),\n            nullif(topup, ''),\n            nullif(secondary_analysis, ''),\n            nullif(workflow, ''),\n            nullif(tags, ''),\n            nullif(fastq, ''),\n            nullif(number_fastqs, ''),\n            nullif(results, ''),\n            nullif(trello, ''),\n            nullif(notes, ''),\n            nullif(todo, ''),\n            nullif(sheet_name, '')\n        ) is not null\n\n),\n\ntransformed as (\n\n    select\n        illumina_id,\n        cast(run as integer),\n        cast(\"timestamp\" as date) as \"timestamp\",\n        subject_id,\n        sample_id,\n        library_id,\n        external_subject_id,\n        external_sample_id,\n        external_library_id,\n        sample_name,\n        project_owner,\n        project_name,\n        project_custodian,\n        type,\n        assay,\n        override_cycles,\n        phenotype,\n        source,\n        quality,\n        topup,\n        secondary_analysis,\n        workflow,\n        tags,\n        fastq,\n        number_fastqs,\n        results,\n        trello,\n        notes,\n        todo,\n        sheet_name,\n        cast(\"timestamp\" as timestamptz) + time '11:00' as load_datetime,\n        (select 'Google_LIMS') as record_source\n    from\n        cleaned\n\n),\n\nfinal as (\n\n    select * from transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"psa\".\"spreadsheet_google_lims\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.753398Z", "completed_at": "2025-04-09T12:57:17.767550Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.770680Z", "completed_at": "2025-04-09T12:57:17.770685Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.019169092178344727, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.hub_s3object", "compiled": true, "compiled_code": "\n\nwith source1 as (\n\n    select\n        bucket,\n        \"key\"\n    from\n        \"orcavault\".\"ods\".\"data_portal_s3object\"\n    \n    where\n        cast(last_modified_date as timestamptz) > ( select coalesce(max(load_datetime), '1900-01-01') as ldts from \"orcavault\".\"dcl\".\"hub_s3object\" )\n    \n\n),\n\nsource2 as (\n\n    select\n        bucket,\n        \"key\"\n    from\n        \"orcavault\".\"ods\".\"file_manager_s3_object\"\n    \n    where\n        cast(event_time as timestamptz) > ( select coalesce(max(load_datetime), '1900-01-01') as ldts from \"orcavault\".\"dcl\".\"hub_s3object\" )\n    \n\n),\n\ncombined as (\n\n    select bucket, \"key\" from source1\n    union\n    select bucket, \"key\" from source2\n\n),\n\ntransformed as (\n\n    select\n        encode(sha256(concat(bucket, \"key\")::bytea), 'hex') as s3object_hk,\n        bucket,\n        \"key\",\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 's3') as record_source,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as last_seen_datetime\n    from\n        combined\n\n),\n\nfinal as (\n\n    select\n        cast(s3object_hk as char(64)) as s3object_hk,\n        cast(bucket as varchar(255)) as bucket,\n        cast(\"key\" as text) as \"key\",\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(last_seen_datetime as timestamptz) as last_seen_datetime\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"hub_s3object\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.762486Z", "completed_at": "2025-04-09T12:57:17.770503Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.771198Z", "completed_at": "2025-04-09T12:57:17.771202Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.01871776580810547, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.spreadsheet_library_tracking_metadata", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select * from \"orcavault\".\"tsa\".\"spreadsheet_library_tracking_metadata\"\n\n),\n\ncleaned as (\n\n    select\n        trim(regexp_replace(assay, E'[\\\\n\\\\r]+', '', 'g')) as assay,\n        trim(regexp_replace(comments, E'[\\\\n\\\\r]+', '', 'g')) as comments,\n        trim(regexp_replace(coverage, E'[\\\\n\\\\r]+', '', 'g')) as coverage,\n        trim(regexp_replace(experiment_id, E'[\\\\n\\\\r]+', '', 'g')) as experiment_id,\n        trim(regexp_replace(external_sample_id, E'[\\\\n\\\\r]+', '', 'g')) as external_sample_id,\n        trim(regexp_replace(external_subject_id, E'[\\\\n\\\\r]+', '', 'g')) as external_subject_id,\n        trim(regexp_replace(library_id, E'[\\\\n\\\\r]+', '', 'g')) as library_id,\n        trim(regexp_replace(override_cycles, E'[\\\\n\\\\r]+', '', 'g')) as override_cycles,\n        trim(regexp_replace(phenotype, E'[\\\\n\\\\r]+', '', 'g')) as phenotype,\n        trim(regexp_replace(project_name, E'[\\\\n\\\\r]+', '', 'g')) as project_name,\n        trim(regexp_replace(project_owner, E'[\\\\n\\\\r]+', '', 'g')) as project_owner,\n        trim(regexp_replace(qpcr_id, E'[\\\\n\\\\r]+', '', 'g')) as qpcr_id,\n        trim(regexp_replace(quality, E'[\\\\n\\\\r]+', '', 'g')) as quality,\n        trim(regexp_replace(run, E'[\\\\n\\\\r]+', '', 'g')) as run,\n        trim(regexp_replace(sample_id, E'[\\\\n\\\\r]+', '', 'g')) as sample_id,\n        trim(regexp_replace(sample_name, E'[\\\\n\\\\r]+', '', 'g')) as sample_name,\n        trim(regexp_replace(samplesheet_sample_id, E'[\\\\n\\\\r]+', '', 'g')) as samplesheet_sample_id,\n        trim(regexp_replace(source, E'[\\\\n\\\\r]+', '', 'g')) as source,\n        trim(regexp_replace(subject_id, E'[\\\\n\\\\r]+', '', 'g')) as subject_id,\n        trim(regexp_replace(truseq_index, E'[\\\\n\\\\r]+', '', 'g')) as truseq_index,\n        trim(regexp_replace(type, E'[\\\\n\\\\r]+', '', 'g')) as type,\n        trim(regexp_replace(workflow, E'[\\\\n\\\\r]+', '', 'g')) as workflow,\n        trim(regexp_replace(r_rna, E'[\\\\n\\\\r]+', '', 'g')) as r_rna,\n        trim(regexp_replace(study, E'[\\\\n\\\\r]+', '', 'g')) as study,\n        trim(regexp_replace(sheet_name, E'[\\\\n\\\\r]+', '', 'g')) as sheet_name\n    from\n        source\n    where\n        coalesce\n        (\n            nullif(assay, ''),\n            nullif(comments, ''),\n            nullif(coverage, ''),\n            nullif(experiment_id, ''),\n            nullif(external_sample_id, ''),\n            nullif(external_subject_id, ''),\n            nullif(library_id, ''),\n            nullif(override_cycles, ''),\n            nullif(phenotype, ''),\n            nullif(project_name, ''),\n            nullif(project_owner, ''),\n            nullif(qpcr_id, ''),\n            nullif(quality, ''),\n            nullif(run, ''),\n            nullif(sample_id, ''),\n            nullif(sample_name, ''),\n            nullif(samplesheet_sample_id, ''),\n            nullif(source, ''),\n            nullif(subject_id, ''),\n            nullif(truseq_index, ''),\n            nullif(type, ''),\n            nullif(workflow, ''),\n            nullif(r_rna, ''),\n            nullif(study, '')\n        ) is not null\n\n),\n\ndifferentiated as (\n\n    select\n        *\n    from\n        cleaned\n    \n    except\n    select\n        assay,\n        comments,\n        coverage,\n        experiment_id,\n        external_sample_id,\n        external_subject_id,\n        library_id,\n        override_cycles,\n        phenotype,\n        project_name,\n        project_owner,\n        qpcr_id,\n        quality,\n        run,\n        sample_id,\n        sample_name,\n        samplesheet_sample_id,\n        source,\n        subject_id,\n        truseq_index,\n        type,\n        workflow,\n        r_rna,\n        study,\n        sheet_name\n    from\n        \"orcavault\".\"psa\".\"spreadsheet_library_tracking_metadata\"\n    \n\n),\n\ntransformed as (\n\n    select\n        *,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'UMCCR_Library_Tracking_MetaData') as record_source\n    from\n        differentiated\n\n),\n\nfinal as (\n\n    select * from transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"psa\".\"spreadsheet_library_tracking_metadata\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.759488Z", "completed_at": "2025-04-09T12:57:17.770992Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.771539Z", "completed_at": "2025-04-09T12:57:17.771542Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.019250154495239258, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.hub_workflow_run", "compiled": true, "compiled_code": "\n\nwith source1 as (\n\n    select\n        portal_run_id\n    from\n        \"orcavault\".\"ods\".\"data_portal_workflow\"\n    \n    where\n        cast(start as timestamptz) > ( select coalesce(max(load_datetime), '1900-01-01') as ldts from \"orcavault\".\"dcl\".\"hub_workflow_run\" )\n    \n\n),\n\nsource2 as (\n\n    select\n        portal_run_id\n    from \"orcavault\".\"ods\".\"workflow_manager_workflowrun\" wfr\n        join \"orcavault\".\"ods\".\"workflow_manager_state\" stt on stt.workflow_run_id = wfr.orcabus_id\n    \n    where\n        cast(stt.timestamp as timestamptz) > ( select coalesce(max(load_datetime), '1900-01-01') as ldts from \"orcavault\".\"dcl\".\"hub_workflow_run\" )\n    \n\n),\n\ncombined as (\n\n    select distinct portal_run_id from source1\n    union\n    select distinct portal_run_id from source2\n\n),\n\ntransformed as (\n\n    select\n        encode(sha256(cast(portal_run_id as bytea)), 'hex') as workflow_run_hk,\n        portal_run_id,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'portal_workflow_manager') as record_source,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as last_seen_datetime\n    from\n        combined\n    order by portal_run_id\n\n),\n\nfinal as (\n\n    select\n        cast(workflow_run_hk as char(64)) as workflow_run_hk,\n        cast(portal_run_id as char(16)) as portal_run_id,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(last_seen_datetime as timestamptz) as last_seen_datetime\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"hub_workflow_run\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.767727Z", "completed_at": "2025-04-09T12:57:17.772495Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.773197Z", "completed_at": "2025-04-09T12:57:17.773200Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.0061321258544921875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.hub_sequencing_run", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select instrument_run_id as sequencing_run_id from \"orcavault\".\"ods\".\"data_portal_libraryrun\"\n    union\n    select instrument_run_id as sequencing_run_id from \"orcavault\".\"ods\".\"data_portal_sequence\"\n    union\n    select instrument_run_id as sequencing_run_id from \"orcavault\".\"ods\".\"data_portal_sequencerun\"\n    union\n    select instrument_run_id as sequencing_run_id from \"orcavault\".\"ods\".\"sequence_run_manager_sequence\"\n    union\n    select illumina_id as sequencing_run_id from \"orcavault\".\"ods\".\"data_portal_limsrow\"\n    union\n    select illumina_id as sequencing_run_id from \"orcavault\".\"psa\".\"spreadsheet_google_lims\"\n\n),\n\ncleaned as (\n\n    select * from source where sequencing_run_id is not null and sequencing_run_id <> ''\n\n),\n\ndifferentiated as (\n\n    select sequencing_run_id from cleaned\n    \n    except\n    select sequencing_run_id from \"orcavault\".\"dcl\".\"hub_sequencing_run\"\n    \n\n),\n\ntransformed as (\n\n    select\n        encode(sha256(cast(sequencing_run_id as bytea)), 'hex') as sequencing_run_hk,\n        sequencing_run_id,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'lab') as record_source,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as last_seen_datetime\n    from\n        differentiated\n\n),\n\nfinal as (\n\n    select\n        cast(sequencing_run_hk as char(64)) as sequencing_run_hk,\n        cast(sequencing_run_id as varchar(255)) as sequencing_run_id,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(last_seen_datetime as timestamptz) as last_seen_datetime\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"hub_sequencing_run\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.779320Z", "completed_at": "2025-04-09T12:57:17.785055Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.785420Z", "completed_at": "2025-04-09T12:57:17.785423Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.012445926666259766, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.sat_s3object_history", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select\n        *\n    from\n        \"orcavault\".\"ods\".\"file_manager_s3_object\"\n    \n    where\n        cast(event_time as timestamptz) > ( select coalesce(max(load_datetime), '1900-01-01') as ldts from \"orcavault\".\"dcl\".\"sat_s3object_history\" )\n    \n\n),\n\ntransformed as (\n\n    select\n        encode(sha256(concat(bucket, \"key\")::bytea), 'hex') as s3object_hk,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'file_manager_s3_object') as record_source,\n        encode(sha256(concat(\n            s3_object_id,\n            \"size\",\n            e_tag,\n            sha256,\n            last_modified_date,\n            event_time,\n            event_type,\n            version_id,\n            is_delete_marker,\n            sequencer,\n            storage_class,\n            attributes,\n            ingest_id,\n            reason,\n            archive_status\n        )::bytea), 'hex') as hash_diff,\n        *\n    from\n        source\n\n),\n\nfinal as (\n\n    select\n        cast(s3object_hk as char(64)) as s3object_hk,\n        cast(hash_diff as char(64)) as s3object_sq,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(hash_diff as char(64)) as hash_diff,\n        cast(s3_object_id as uuid) as s3_object_id,\n        cast(\"size\" as bigint) as \"size\",\n        cast(e_tag as varchar(255)) as e_tag,\n        cast(sha256 as text) as sha256,\n        cast(last_modified_date as timestamptz) as last_modified_date,\n        cast(event_time as timestamptz) as event_time,\n        cast(event_type as varchar(255)) as event_type,\n        cast(version_id as varchar(255)) as version_id,\n        cast(is_delete_marker as boolean) as is_delete_marker,\n        cast(sequencer as varchar(255)) as sequencer,\n        cast(storage_class as varchar(255)) as storage_class,\n        cast(attributes as jsonb) as attributes,\n        cast(ingest_id as uuid) as ingest_id,\n        cast(reason as varchar(255)) as reason,\n        cast(archive_status as varchar(255)) as archive_status\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"sat_s3object_history\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.776821Z", "completed_at": "2025-04-09T12:57:17.785237Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.785735Z", "completed_at": "2025-04-09T12:57:17.785738Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.012920141220092773, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.sat_s3object_by_library", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select\n        s3object_hk,\n        (regexp_matches(\"key\", '(?:L\\d{7}|L(?:PRJ|CCR|MDX|TGX)\\d{6}|Undetermined)(?:(?:_topup\\d?)|(?:_rerun\\d?))?', 'g'))[1] as library_id,\n        regexp_replace(\"key\", '^.+[/\\\\]', '') as filename,\n        split_part(regexp_replace(\"key\", '^.+[/\\\\]', ''), '.', -1) as ext1,\n        split_part(regexp_replace(\"key\", '^.+[/\\\\]', ''), '.', -2) as ext2,\n        split_part(regexp_replace(\"key\", '^.+[/\\\\]', ''), '.', -3) as ext3,\n        load_datetime,\n        record_source\n    from\n        \"orcavault\".\"dcl\".\"hub_s3object\"\n    \n    where\n        cast(load_datetime as timestamptz) > ( select coalesce(max(load_datetime), '1900-01-01') as ldts from \"orcavault\".\"dcl\".\"sat_s3object_by_library\" )\n    \n    group by s3object_hk, library_id\n\n),\n\ntransformed as (\n\n    select\n        s3object_hk,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        record_source,\n        encode(sha256(concat(s3object_hk, library_id)::bytea), 'hex') as hash_diff,\n        library_id,\n        filename,\n        ext1,\n        ext2,\n        ext3\n    from\n        source\n\n),\n\nfinal as (\n\n    select\n        cast(s3object_hk as char(64)) as s3object_hk,\n        cast(hash_diff as char(64)) as s3object_sq,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(hash_diff as char(64)) as hash_diff,\n        cast(library_id as varchar(255)) as library_id,\n        cast(filename as text) as filename,\n        cast(ext1 as varchar(255)) as ext1,\n        cast(ext2 as varchar(255)) as ext2,\n        cast(ext3 as varchar(255)) as ext3\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"sat_s3object_by_library\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.782130Z", "completed_at": "2025-04-09T12:57:17.786027Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.786732Z", "completed_at": "2025-04-09T12:57:17.786734Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.005085945129394531, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.sat_s3object_portal", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select\n        id,\n        bucket,\n        \"key\",\n        \"size\",\n        e_tag,\n        cast(last_modified_date as timestamptz) as last_modified_date\n    from\n        \"orcavault\".\"ods\".\"data_portal_s3object\"\n    \n    where\n        cast(last_modified_date as timestamptz) > ( select coalesce(max(load_datetime), '1900-01-01') as ldts from \"orcavault\".\"dcl\".\"sat_s3object_portal\" )\n    \n\n),\n\ntransformed as (\n\n    select\n        encode(sha256(concat(bucket, \"key\")::bytea), 'hex') as s3object_hk,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'data_portal_s3object') as record_source,\n        encode(sha256(concat(id, \"size\", e_tag, last_modified_date)::bytea), 'hex') as hash_diff,\n        id,\n        \"size\",\n        e_tag,\n        last_modified_date,\n        (select 0) as is_deleted\n    from\n        source\n\n),\n\nfinal as (\n\n    select\n        cast(s3object_hk as char(64)) as s3object_hk,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(hash_diff as char(64)) as hash_diff,\n        cast(id as bigint) as id,\n        cast(\"size\" as bigint) as \"size\",\n        cast(e_tag as varchar(255)) as e_tag,\n        cast(last_modified_date as timestamptz) as last_modified_date,\n        cast(is_deleted as smallint) as is_deleted\n    from\n        transformed\n\n)\n\nselect * from final\n\nunion\n    select\n        cast(t.s3object_hk as char(64)) as s3object_hk,\n        cast(t.load_datetime as timestamptz) as load_datetime,\n        cast(t.record_source as varchar(255)) as record_source,\n        cast(t.hash_diff as char(64)) as hash_diff,\n        cast(t.id as bigint) as id,\n        cast(t.\"size\" as bigint) as \"size\",\n        cast(t.e_tag as varchar(255)) as e_tag,\n        cast(t.last_modified_date as timestamptz) as last_modified_date,\n        cast((select 1) as smallint) as is_deleted\n    from \"orcavault\".\"dcl\".\"sat_s3object_portal\" t\n        left join \"orcavault\".\"ods\".\"data_portal_s3object\" s on s.id = t.id\n    where\n        s.id is null and t.is_deleted = 0\n", "relation_name": "\"orcavault\".\"dcl\".\"sat_s3object_portal\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.774102Z", "completed_at": "2025-04-09T12:57:17.786182Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.787010Z", "completed_at": "2025-04-09T12:57:17.787012Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.014379024505615234, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.sat_s3object_by_run", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select\n        s3object_hk,\n        (regexp_match(\"key\", '(?:/)(\\d{8}[a-zA-Z0-9]{8})(?:/)'))[1] as portal_run_id,\n        (regexp_match(\"key\", '(?:/)(\\d{6}_A\\d{5}_\\d{4}_[A-Z0-9]{10})(?:/)'))[1] as sequencing_run_id,\n        regexp_replace(\"key\", '^.+[/\\\\]', '') as filename,\n        split_part(regexp_replace(\"key\", '^.+[/\\\\]', ''), '.', -1) as ext1,\n        split_part(regexp_replace(\"key\", '^.+[/\\\\]', ''), '.', -2) as ext2,\n        split_part(regexp_replace(\"key\", '^.+[/\\\\]', ''), '.', -3) as ext3,\n        load_datetime,\n        record_source\n    from\n        \"orcavault\".\"dcl\".\"hub_s3object\"\n    \n    where\n        cast(load_datetime as timestamptz) > ( select coalesce(max(load_datetime), '1900-01-01') as ldts from \"orcavault\".\"dcl\".\"sat_s3object_by_run\" )\n    \n    group by s3object_hk, portal_run_id, sequencing_run_id\n\n),\n\ntransformed as (\n\n    select\n        s3object_hk,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        record_source,\n        encode(sha256(concat(s3object_hk, portal_run_id, sequencing_run_id)::bytea), 'hex') as hash_diff,\n        portal_run_id,\n        sequencing_run_id,\n        filename,\n        ext1,\n        ext2,\n        ext3\n    from\n        source\n\n),\n\nfinal as (\n\n    select\n        cast(s3object_hk as char(64)) as s3object_hk,\n        cast(hash_diff as char(64)) as s3object_sq,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(hash_diff as char(64)) as hash_diff,\n        cast(portal_run_id as char(16)) as portal_run_id,\n        cast(sequencing_run_id as varchar(255)) as sequencing_run_id,\n        cast(filename as text) as filename,\n        cast(ext1 as varchar(255)) as ext1,\n        cast(ext2 as varchar(255)) as ext2,\n        cast(ext3 as varchar(255)) as ext3\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"sat_s3object_by_run\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.790748Z", "completed_at": "2025-04-09T12:57:17.798777Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.799160Z", "completed_at": "2025-04-09T12:57:17.799163Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.011761188507080078, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.hub_external_sample", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select external_sample_id from \"orcavault\".\"ods\".\"data_portal_labmetadata\"\n    union\n    select external_sample_id from \"orcavault\".\"ods\".\"data_portal_limsrow\"\n    union\n    select external_sample_id from \"orcavault\".\"ods\".\"metadata_manager_sample\"\n    union\n    select external_sample_id from \"orcavault\".\"psa\".\"spreadsheet_library_tracking_metadata\"\n    union\n    select external_sample_id from \"orcavault\".\"psa\".\"spreadsheet_google_lims\"\n\n),\n\ncleaned as (\n\n    select * from source where external_sample_id is not null and external_sample_id <> ''\n\n),\n\ndifferentiated as (\n\n    select external_sample_id from cleaned\n    \n    except\n    select external_sample_id from \"orcavault\".\"dcl\".\"hub_external_sample\"\n    \n\n),\n\ntransformed as (\n\n    select\n        encode(sha256(cast(external_sample_id as bytea)), 'hex') as external_sample_hk,\n        external_sample_id,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'lab') as record_source,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as last_seen_datetime\n    from\n        differentiated\n\n),\n\nfinal as (\n\n    select\n        cast(external_sample_hk as char(64)) as external_sample_hk,\n        cast(external_sample_id as varchar(255)) as external_sample_id,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(last_seen_datetime as timestamptz) as last_seen_datetime\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"hub_external_sample\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.788604Z", "completed_at": "2025-04-09T12:57:17.798945Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.799471Z", "completed_at": "2025-04-09T12:57:17.799473Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.012244939804077148, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.hub_experiment", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select experiment_id from \"orcavault\".\"ods\".\"data_portal_labmetadata\"\n    union\n    select experiment_id from \"orcavault\".\"psa\".\"spreadsheet_library_tracking_metadata\"\n\n),\n\ncleaned as (\n\n    select\n        distinct trim(experiment_id) as experiment_id\n    from\n        source\n    where\n        experiment_id is not null and experiment_id <> ''\n\n),\n\ndifferentiated as (\n\n    select experiment_id from cleaned\n    \n    except\n    select experiment_id from \"orcavault\".\"dcl\".\"hub_experiment\"\n    \n\n),\n\ntransformed as (\n\n    select\n        encode(sha256(cast(experiment_id as bytea)), 'hex') as experiment_hk,\n        experiment_id,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'lab') as record_source,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as last_seen_datetime\n    from\n        differentiated\n\n),\n\nfinal as (\n\n    select\n        cast(experiment_hk as char(64)) as experiment_hk,\n        cast(experiment_id as varchar(255)) as experiment_id,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(last_seen_datetime as timestamptz) as last_seen_datetime\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"hub_experiment\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.793790Z", "completed_at": "2025-04-09T12:57:17.799914Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.800571Z", "completed_at": "2025-04-09T12:57:17.800573Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.01232600212097168, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.hub_external_subject", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select external_subject_id from \"orcavault\".\"ods\".\"data_portal_labmetadata\"\n    union\n    select external_subject_id from \"orcavault\".\"ods\".\"data_portal_limsrow\"\n    union\n    select subject_id as external_subject_id from \"orcavault\".\"ods\".\"metadata_manager_subject\"\n    union\n    select external_subject_id from \"orcavault\".\"psa\".\"spreadsheet_library_tracking_metadata\"\n    union\n    select external_subject_id from \"orcavault\".\"psa\".\"spreadsheet_google_lims\"\n\n),\n\ncleaned as (\n\n    select * from source where external_subject_id is not null and external_subject_id <> ''\n\n),\n\ndifferentiated as (\n\n    select external_subject_id from cleaned\n    \n    except\n    select external_subject_id from \"orcavault\".\"dcl\".\"hub_external_subject\"\n    \n\n),\n\ntransformed as (\n\n    select\n        encode(sha256(cast(external_subject_id as bytea)), 'hex') as external_subject_hk,\n        external_subject_id,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'lab') as record_source,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as last_seen_datetime\n    from\n        differentiated\n\n),\n\nfinal as (\n\n    select\n        cast(external_subject_hk as char(64)) as external_subject_hk,\n        cast(external_subject_id as varchar(255)) as external_subject_id,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(last_seen_datetime as timestamptz) as last_seen_datetime\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"hub_external_subject\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.796309Z", "completed_at": "2025-04-09T12:57:17.800255Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.801002Z", "completed_at": "2025-04-09T12:57:17.801004Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.012589693069458008, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.hub_internal_subject", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select subject_id as internal_subject_id from \"orcavault\".\"ods\".\"data_portal_labmetadata\"\n    union\n    select subject_id as internal_subject_id from \"orcavault\".\"ods\".\"data_portal_limsrow\"\n    union\n    select individual_id as internal_subject_id from \"orcavault\".\"ods\".\"metadata_manager_individual\"\n    union\n    select subject_id as internal_subject_id from \"orcavault\".\"psa\".\"spreadsheet_library_tracking_metadata\"\n    union\n    select subject_id as internal_subject_id from \"orcavault\".\"psa\".\"spreadsheet_google_lims\"\n\n),\n\ncleaned as (\n\n    select * from source where internal_subject_id is not null and internal_subject_id <> ''\n\n),\n\ndifferentiated as (\n\n    select internal_subject_id from cleaned\n    \n    except\n    select internal_subject_id from \"orcavault\".\"dcl\".\"hub_internal_subject\"\n    \n\n),\n\ntransformed as (\n\n    select\n        encode(sha256(cast(internal_subject_id as bytea)), 'hex') as internal_subject_hk,\n        internal_subject_id,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'lab') as record_source,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as last_seen_datetime\n    from\n        differentiated\n\n),\n\nfinal as (\n\n    select\n        cast(internal_subject_hk as char(64)) as internal_subject_hk,\n        cast(internal_subject_id as varchar(255)) as internal_subject_id,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(last_seen_datetime as timestamptz) as last_seen_datetime\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"hub_internal_subject\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.806075Z", "completed_at": "2025-04-09T12:57:17.814071Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.814250Z", "completed_at": "2025-04-09T12:57:17.814254Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.013443946838378906, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.hub_owner", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select project_owner as owner_id from \"orcavault\".\"ods\".\"data_portal_labmetadata\"\n    union\n    select project_owner as owner_id from \"orcavault\".\"ods\".\"data_portal_limsrow\"\n    union\n    select contact_id as owner_id from \"orcavault\".\"ods\".\"metadata_manager_contact\"\n    union\n    select project_owner as owner_id from \"orcavault\".\"psa\".\"spreadsheet_library_tracking_metadata\"\n    union\n    select project_owner as owner_id from \"orcavault\".\"psa\".\"spreadsheet_google_lims\"\n\n),\n\ncleaned as (\n\n    select * from source where owner_id is not null and owner_id <> ''\n\n),\n\ndifferentiated as (\n\n    select owner_id from cleaned\n    \n    except\n    select owner_id from \"orcavault\".\"dcl\".\"hub_owner\"\n    \n\n),\n\ntransformed as (\n\n    select\n        encode(sha256(cast(owner_id as bytea)), 'hex') as owner_hk,\n        owner_id,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'lab') as record_source,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as last_seen_datetime\n    from\n        differentiated\n\n),\n\nfinal as (\n\n    select\n        cast(owner_hk as char(64)) as owner_hk,\n        cast(owner_id as varchar(255)) as owner_id,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(last_seen_datetime as timestamptz) as last_seen_datetime\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"hub_owner\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.801979Z", "completed_at": "2025-04-09T12:57:17.814537Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.815080Z", "completed_at": "2025-04-09T12:57:17.815083Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.014714956283569336, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.hub_library", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select library_id from \"orcavault\".\"ods\".\"data_portal_labmetadata\"\n    union\n    select library_id from \"orcavault\".\"ods\".\"data_portal_limsrow\"\n    union\n    select library_id from \"orcavault\".\"ods\".\"metadata_manager_library\"\n    union\n    select library_id from \"orcavault\".\"psa\".\"spreadsheet_library_tracking_metadata\"\n    union\n    select library_id from \"orcavault\".\"psa\".\"spreadsheet_google_lims\"\n\n),\n\ncleaned as (\n\n    select * from source where library_id is not null and library_id <> ''\n\n),\n\ndifferentiated as (\n\n    select library_id from cleaned\n    \n    except\n    select library_id from \"orcavault\".\"dcl\".\"hub_library\"\n    \n\n),\n\ntransformed as (\n\n    select\n        encode(sha256(cast(library_id as bytea)), 'hex') as library_hk,\n        library_id,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'lab') as record_source,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as last_seen_datetime\n    from\n        differentiated\n\n),\n\nfinal as (\n\n    select\n        cast(library_hk as char(64)) as library_hk,\n        cast(library_id as varchar(255)) as library_id,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(last_seen_datetime as timestamptz) as last_seen_datetime\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"hub_library\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.811580Z", "completed_at": "2025-04-09T12:57:17.814907Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.815700Z", "completed_at": "2025-04-09T12:57:17.815702Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0073089599609375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.hub_sample", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select sample_id from \"orcavault\".\"ods\".\"data_portal_labmetadata\"\n    union\n    select sample_id from \"orcavault\".\"ods\".\"data_portal_limsrow\"\n    union\n    select sample_id from \"orcavault\".\"ods\".\"metadata_manager_sample\"\n    union\n    select sample_id from \"orcavault\".\"psa\".\"spreadsheet_library_tracking_metadata\"\n    union\n    select sample_id from \"orcavault\".\"psa\".\"spreadsheet_google_lims\"\n\n),\n\ncleaned as (\n\n    select * from source where sample_id is not null and sample_id <> ''\n\n),\n\ndifferentiated as (\n\n    select sample_id from cleaned\n    \n    except\n    select sample_id from \"orcavault\".\"dcl\".\"hub_sample\"\n    \n\n),\n\ntransformed as (\n\n    select\n        encode(sha256(cast(sample_id as bytea)), 'hex') as sample_hk,\n        sample_id,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'lab') as record_source,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as last_seen_datetime\n    from\n        differentiated\n\n),\n\nfinal as (\n\n    select\n        cast(sample_hk as char(64)) as sample_hk,\n        cast(sample_id as varchar(255)) as sample_id,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(last_seen_datetime as timestamptz) as last_seen_datetime\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"hub_sample\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.808990Z", "completed_at": "2025-04-09T12:57:17.815357Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.816145Z", "completed_at": "2025-04-09T12:57:17.816148Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.010280847549438477, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.hub_project", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select project_name as project_id from \"orcavault\".\"ods\".\"data_portal_labmetadata\"\n    union\n    select project_name as project_id from \"orcavault\".\"ods\".\"data_portal_limsrow\"\n    union\n    select project_id from \"orcavault\".\"ods\".\"metadata_manager_project\"\n    union\n    select project_name as project_id from \"orcavault\".\"psa\".\"spreadsheet_library_tracking_metadata\"\n    union\n    select project_name as project_id from \"orcavault\".\"psa\".\"spreadsheet_google_lims\"\n\n),\n\ncleaned as (\n\n    select * from source where project_id is not null and project_id <> ''\n\n),\n\ndifferentiated as (\n\n    select project_id from cleaned\n    \n    except\n    select project_id from \"orcavault\".\"dcl\".\"hub_project\"\n    \n\n),\n\ntransformed as (\n\n    select\n        encode(sha256(cast(project_id as bytea)), 'hex') as project_hk,\n        project_id,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'lab') as record_source,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as last_seen_datetime\n    from\n        differentiated\n\n),\n\nfinal as (\n\n    select\n        cast(project_hk as char(64)) as project_hk,\n        cast(project_id as varchar(255)) as project_id,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(last_seen_datetime as timestamptz) as last_seen_datetime\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"hub_project\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.817196Z", "completed_at": "2025-04-09T12:57:17.823807Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.825652Z", "completed_at": "2025-04-09T12:57:17.825655Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.010158061981201172, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.sat_workflow_run_comment", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select\n        wfr.portal_run_id as portal_run_id,\n        cmt.orcabus_id as orcabus_id,\n        cmt.comment as comment,\n        cmt.created_at as created_at,\n        cmt.created_by as created_by,\n        cmt.updated_at as updated_at,\n        cmt.is_deleted as is_deleted\n    from \"orcavault\".\"ods\".\"workflow_manager_workflowrun\" wfr\n        join \"orcavault\".\"ods\".\"workflow_manager_workflowruncomment\" cmt on cmt.workflow_run_id = wfr.orcabus_id\n    \n    where\n        cast(cmt.created_at as timestamptz) > ( select coalesce(max(load_datetime), '1900-01-01') as ldts from \"orcavault\".\"dcl\".\"sat_workflow_run_comment\" )\n    \n\n),\n\ntransformed as (\n\n    select\n        encode(sha256(cast(portal_run_id as bytea)), 'hex') as workflow_run_hk,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'workflow_manager_workflowruncomment') as record_source,\n        encode(sha256(concat(\n            orcabus_id,\n            comment,\n            created_at,\n            created_by,\n            updated_at,\n            is_deleted\n        )::bytea), 'hex') as hash_diff,\n        orcabus_id,\n        comment,\n        created_at,\n        created_by,\n        updated_at,\n        is_deleted\n    from\n        source\n\n),\n\nfinal as (\n\n    select\n        cast(workflow_run_hk as char(64)) as workflow_run_hk,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(hash_diff as char(64)) as hash_diff,\n        cast(orcabus_id as char(26)) as orcabus_id,\n        cast(comment as text) as comment,\n        cast(created_at as timestamptz) as created_at,\n        cast(created_by as varchar(255)) as created_by,\n        cast(updated_at as timestamptz) as updated_at,\n        cast(is_deleted as boolean) as is_deleted\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"sat_workflow_run_comment\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.819835Z", "completed_at": "2025-04-09T12:57:17.826211Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.826750Z", "completed_at": "2025-04-09T12:57:17.826753Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009984016418457031, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.sat_workflow_run_detail", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select\n        wfr.portal_run_id as portal_run_id,\n        wfr.orcabus_id as workflow_run_orcabus_id,\n        wfr.execution_id as workflow_run_execution_id,\n        wfr.workflow_run_name as workflow_run_name,\n        wfr.comment as workflow_run_comment,\n        wfl.orcabus_id as workflow_orcabus_id,\n        wfl.workflow_name as workflow_name,\n        wfl.workflow_version as workflow_version,\n        wfl.execution_engine as workflow_execution_engine,\n        wfl.execution_engine_pipeline_id as workflow_execution_engine_pipeline_id,\n        stt.orcabus_id as state_orcabus_id,\n        stt.status as state_status,\n        stt.timestamp as state_timestamp,\n        stt.comment as state_comment,\n        pld.orcabus_id as payload_orcabus_id,\n        pld.payload_ref_id as payload_ref_id,\n        pld.version as payload_version,\n        pld.data as payload_data\n    from \"orcavault\".\"ods\".\"workflow_manager_workflowrun\" wfr\n        join \"orcavault\".\"ods\".\"workflow_manager_workflow\" wfl on wfl.orcabus_id = wfr.workflow_id\n        join \"orcavault\".\"ods\".\"workflow_manager_state\" stt on stt.workflow_run_id = wfr.orcabus_id\n        full join \"orcavault\".\"ods\".\"workflow_manager_payload\" pld on pld.orcabus_id = stt.payload_id\n    \n    where\n        cast(stt.timestamp as timestamptz) > ( select coalesce(max(load_datetime), '1900-01-01') as ldts from \"orcavault\".\"dcl\".\"sat_workflow_run_detail\" )\n    \n\n),\n\ntransformed as (\n\n    select\n        encode(sha256(cast(portal_run_id as bytea)), 'hex') as workflow_run_hk,\n        encode(sha256(cast(state_orcabus_id as bytea)), 'hex') as workflow_run_sq,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'workflow_manager') as record_source,\n        encode(sha256(concat(\n            workflow_run_orcabus_id,\n            workflow_run_execution_id,\n            workflow_run_name,\n            workflow_run_comment,\n            workflow_orcabus_id,\n            workflow_name,\n            workflow_version,\n            workflow_execution_engine,\n            workflow_execution_engine_pipeline_id,\n            state_orcabus_id,\n            state_status,\n            state_timestamp,\n            state_comment,\n            payload_orcabus_id,\n            payload_ref_id,\n            payload_version\n        )::bytea), 'hex') as hash_diff,\n        workflow_run_orcabus_id,\n        workflow_run_execution_id,\n        workflow_run_name,\n        workflow_run_comment,\n        workflow_orcabus_id,\n        workflow_name,\n        workflow_version,\n        workflow_execution_engine,\n        workflow_execution_engine_pipeline_id,\n        state_orcabus_id,\n        state_status,\n        state_timestamp,\n        state_comment,\n        payload_orcabus_id,\n        payload_ref_id,\n        payload_version,\n        payload_data\n    from\n        source\n\n),\n\nfinal as (\n\n    select\n        cast(workflow_run_hk as char(64)) as workflow_run_hk,\n        cast(workflow_run_sq as char(64)) as workflow_run_sq,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(hash_diff as char(64)) as hash_diff,\n        cast(workflow_run_orcabus_id as char(26)) as workflow_run_orcabus_id,\n        cast(workflow_run_execution_id as varchar(255)) as workflow_run_execution_id,\n        cast(workflow_run_name as varchar(255)) as workflow_run_name,\n        cast(workflow_run_comment as varchar(255)) as workflow_run_comment,\n        cast(workflow_orcabus_id as char(26)) as workflow_orcabus_id,\n        cast(workflow_name as varchar(255)) as workflow_name,\n        cast(workflow_version as varchar(255)) as workflow_version,\n        cast(workflow_execution_engine as varchar(255)) as workflow_execution_engine,\n        cast(workflow_execution_engine_pipeline_id as varchar(255)) as workflow_execution_engine_pipeline_id,\n        cast(state_orcabus_id as varchar(26)) as state_orcabus_id,\n        cast(state_status as varchar(255)) as state_status,\n        cast(state_timestamp as timestamptz) as state_timestamp,\n        cast(state_comment as varchar(255)) as state_comment,\n        cast(payload_orcabus_id as char(26)) as payload_orcabus_id,\n        cast(payload_ref_id as varchar(255)) as payload_ref_id,\n        cast(payload_version as varchar(255)) as payload_version,\n        cast(payload_data as jsonb) as payload_data\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"sat_workflow_run_detail\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.822009Z", "completed_at": "2025-04-09T12:57:17.826573Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.827320Z", "completed_at": "2025-04-09T12:57:17.827322Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008222818374633789, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.sat_workflow_run_portal", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select\n        id,\n        type_name,\n        wfr_name,\n        wfr_id,\n        wfl_id,\n        wfv_id,\n        version,\n        start as start_datetime,\n        \"end\" as end_datetime,\n        end_status,\n        \"input\" as input_json,\n        \"output\" as output_json,\n        portal_run_id\n    from\n        \"orcavault\".\"ods\".\"data_portal_workflow\"\n    \n    where\n        cast(start as timestamptz) > ( select coalesce(max(load_datetime), '1900-01-01') as ldts from \"orcavault\".\"dcl\".\"sat_workflow_run_portal\" )\n    \n\n),\n\ntransformed as (\n\n    select\n        encode(sha256(cast(portal_run_id as bytea)), 'hex') as workflow_run_hk,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'data_portal_workflow') as record_source,\n        encode(sha256(concat(\n                id,\n                type_name,\n                wfr_name,\n                wfr_id,\n                wfl_id,\n                wfv_id,\n                version,\n                start_datetime,\n                end_datetime,\n                end_status\n        )::bytea), 'hex') as hash_diff,\n        id,\n        type_name,\n        wfr_name,\n        wfr_id,\n        wfl_id,\n        wfv_id,\n        version,\n        start_datetime,\n        end_datetime,\n        end_status,\n        input_json,\n        output_json\n    from\n        source\n\n),\n\nfinal as (\n\n    select\n        cast(workflow_run_hk as char(64)) as workflow_run_hk,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(hash_diff as char(64)) as hash_diff,\n        cast(id as bigint) as id,\n        cast(type_name as varchar(255)) as type_name,\n        cast(wfr_name as text) as wfr_name,\n        cast(wfr_id as varchar(255)) as wfr_id,\n        cast(wfl_id as varchar(255)) as wfl_id,\n        cast(wfv_id as varchar(255)) as wfv_id,\n        cast(version as varchar(255)) as version,\n        cast(start_datetime as timestamptz) as start_datetime,\n        cast(end_datetime as timestamptz) as end_datetime,\n        cast(end_status as varchar(255)) as end_status,\n        cast(input_json as jsonb) as input_json,\n        cast(output_json as jsonb) as output_json\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"sat_workflow_run_portal\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.823986Z", "completed_at": "2025-04-09T12:57:17.827017Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.827730Z", "completed_at": "2025-04-09T12:57:17.827732Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.008273839950561523, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.sat_sequencing_run_comment", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select\n        seq.instrument_run_id as sequencing_run_id,\n        cmt.orcabus_id as orcabus_id,\n        cmt.created_by as created_by,\n        cmt.created_at as created_at,\n        cmt.updated_at as updated_at,\n        cmt.is_deleted as is_deleted,\n        cmt.comment as comment\n    from \"orcavault\".\"ods\".\"sequence_run_manager_sequence\" seq\n        join \"orcavault\".\"ods\".\"sequence_run_manager_comment\" cmt on cmt.association_id = seq.orcabus_id\n    \n    where\n        cast(cmt.created_at as timestamptz) > ( select coalesce(max(load_datetime), '1900-01-01') as ldts from \"orcavault\".\"dcl\".\"sat_sequencing_run_comment\" )\n    \n\n),\n\ntransformed as (\n\n    select\n        encode(sha256(cast(sequencing_run_id as bytea)), 'hex') as sequencing_run_hk,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'sequence_run_manager_comment') as record_source,\n        encode(sha256(concat(\n            orcabus_id,\n            created_by,\n            created_at,\n            updated_at,\n            is_deleted\n        )::bytea), 'hex') as hash_diff,\n        orcabus_id,\n        created_by,\n        created_at,\n        updated_at,\n        is_deleted,\n        comment\n    from\n        source\n\n),\n\nfinal as (\n\n    select\n        cast(sequencing_run_hk as char(64)) as sequencing_run_hk,\n        cast(hash_diff as char(64)) as sequencing_run_sq,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(hash_diff as char(64)) as hash_diff,\n        cast(orcabus_id as char(26)) as orcabus_id,\n        cast(created_by as varchar(255)) as created_by,\n        cast(created_at as timestamptz) as created_at,\n        cast(updated_at as timestamptz) as updated_at,\n        cast(is_deleted as boolean) as is_deleted,\n        cast(comment as text) as comment\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"sat_sequencing_run_comment\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.827963Z", "completed_at": "2025-04-09T12:57:17.830828Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.836466Z", "completed_at": "2025-04-09T12:57:17.836470Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.010123968124389648, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.sat_sequencing_run_detail", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select\n        instrument_run_id as sequencing_run_id,\n        orcabus_id,\n        status,\n        start_time,\n        end_time,\n        reagent_barcode,\n        flowcell_barcode,\n        ica_project_id,\n        v1pre3_id,\n        sequence_run_id as basespace_run_id,\n        experiment_name\n    from \"orcavault\".\"ods\".\"sequence_run_manager_sequence\"\n    where\n        end_time is not null\n    \n    and\n        cast(end_time as timestamptz) > ( select coalesce(max(load_datetime), '1900-01-01') as ldts from \"orcavault\".\"dcl\".\"sat_sequencing_run_detail\" )\n    \n\n),\n\ntransformed as (\n\n    select\n        encode(sha256(cast(sequencing_run_id as bytea)), 'hex') as sequencing_run_hk,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'sequence_run_manager_sequence') as record_source,\n        encode(sha256(concat(\n            orcabus_id,\n            status,\n            start_time,\n            end_time,\n            reagent_barcode,\n            flowcell_barcode,\n            ica_project_id,\n            v1pre3_id,\n            basespace_run_id,\n            experiment_name\n        )::bytea), 'hex') as hash_diff,\n        orcabus_id,\n        status,\n        start_time,\n        end_time,\n        reagent_barcode,\n        flowcell_barcode,\n        ica_project_id,\n        v1pre3_id,\n        basespace_run_id,\n        experiment_name\n    from\n        source\n\n),\n\nfinal as (\n\n    select\n        cast(sequencing_run_hk as char(64)) as sequencing_run_hk,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(hash_diff as char(64)) as hash_diff,\n        cast(orcabus_id as char(26)) as orcabus_id,\n        cast(status as varchar(255)) as status,\n        cast(start_time as timestamptz) as start_time,\n        cast(end_time as timestamptz) as end_time,\n        cast(reagent_barcode as varchar(255)) as reagent_barcode,\n        cast(flowcell_barcode as varchar(255)) as flowcell_barcode,\n        cast(ica_project_id as varchar(255)) as ica_project_id,\n        cast(v1pre3_id as varchar(255)) as v1pre3_id,\n        cast(basespace_run_id as varchar(255)) as basespace_run_id,\n        cast(experiment_name as varchar(255)) as experiment_name\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"sat_sequencing_run_detail\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.830977Z", "completed_at": "2025-04-09T12:57:17.842290Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.842544Z", "completed_at": "2025-04-09T12:57:17.842547Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.012865066528320312, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.sat_sequencing_run_samplesheet", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select\n        seq.instrument_run_id as sequencing_run_id,\n        ss.orcabus_id as orcabus_id,\n        ss.association_status as association_status,\n        ss.association_timestamp as association_timestamp,\n        ss.sample_sheet_name as samplesheet_name,\n        ss.sample_sheet_content as samplesheet_content\n    from \"orcavault\".\"ods\".\"sequence_run_manager_sequence\" seq\n        join \"orcavault\".\"ods\".\"sequence_run_manager_samplesheet\" ss on ss.sequence_id = seq.orcabus_id\n    \n    where\n        cast(ss.association_timestamp as timestamptz) > ( select coalesce(max(load_datetime), '1900-01-01') as ldts from \"orcavault\".\"dcl\".\"sat_sequencing_run_samplesheet\" )\n    \n\n),\n\ntransformed as (\n\n    select\n        encode(sha256(cast(sequencing_run_id as bytea)), 'hex') as sequencing_run_hk,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'sequence_run_manager_samplesheet') as record_source,\n        encode(sha256(concat(\n            orcabus_id,\n            association_status,\n            association_timestamp,\n            samplesheet_name\n        )::bytea), 'hex') as hash_diff,\n        orcabus_id,\n        association_status,\n        association_timestamp,\n        samplesheet_name,\n        samplesheet_content\n    from\n        source\n\n),\n\nfinal as (\n\n    select\n        cast(sequencing_run_hk as char(64)) as sequencing_run_hk,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(hash_diff as char(64)) as hash_diff,\n        cast(orcabus_id as char(26)) as orcabus_id,\n        cast(association_status as varchar(255)) as association_status,\n        cast(association_timestamp as timestamptz) as association_timestamp,\n        cast(samplesheet_name as varchar(255)) as samplesheet_name,\n        cast(samplesheet_content as jsonb) as samplesheet_content\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"sat_sequencing_run_samplesheet\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.833225Z", "completed_at": "2025-04-09T12:57:17.842836Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.843447Z", "completed_at": "2025-04-09T12:57:17.843452Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.013375282287597656, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.sat_s3object_current", "compiled": true, "compiled_code": "\n\nwith incremental as (\n\n    select\n        distinct s3object_hk\n    from\n        \"orcavault\".\"dcl\".\"sat_s3object_history\"\n    \n    where\n        cast(event_time as timestamptz) > ( select coalesce(max(load_datetime), '1900-01-01') as ldts from \"orcavault\".\"dcl\".\"sat_s3object_current\" )\n    \n\n),\n\nhistory as (\n\n    select\n        h.*,\n        row_number() over (partition by h.s3object_hk, cast(h.event_time as date) order by cast(h.event_time as date) desc) as rank_by_daily\n    from\n        \"orcavault\".\"dcl\".\"sat_s3object_history\" h\n        join incremental i on i.s3object_hk = h.s3object_hk\n\n),\n\ndaily as (\n\n    select\n        *,\n        row_number() over (partition by s3object_hk order by cast(event_time as date) desc) as rank_by_group\n    from\n        history\n    where\n        rank_by_daily = 1\n\n),\n\ntransformed as (\n\n    select\n        s3object_hk,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        record_source,\n        encode(sha256(concat(\n            s3_object_id,\n            \"size\",\n            e_tag,\n            sha256,\n            last_modified_date,\n            storage_class,\n            attributes,\n            ingest_id,\n            reason\n        )::bytea), 'hex') as hash_diff,\n        s3_object_id,\n        \"size\",\n        e_tag,\n        sha256,\n        last_modified_date,\n        storage_class,\n        attributes,\n        ingest_id,\n        reason,\n        cast(event_time as timestamptz) as effective_from,\n        case\n            when (rank_by_group = 1) then\n                cast('9999-12-31' as date)\n            else\n                lag(event_time) over (partition by s3object_hk order by rank_by_group)\n            end as effective_to,\n        case when (rank_by_group = 1) then 1 else 0 end as is_current,\n        case when (event_type = 'Deleted') then 1 else 0 end as is_deleted\n    from\n        daily\n\n),\n\nfinal as (\n\n    select\n        cast(s3object_hk as char(64)) as s3object_hk,\n        cast(hash_diff as char(64)) as s3object_sq,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(hash_diff as char(64)) as hash_diff,\n        cast(s3_object_id as uuid) as s3_object_id,\n        cast(\"size\" as bigint) as \"size\",\n        cast(e_tag as varchar(255)) as e_tag,\n        cast(sha256 as text) as sha256,\n        cast(last_modified_date as timestamptz) as last_modified_date,\n        cast(storage_class as varchar(255)) as storage_class,\n        cast(attributes as jsonb) as attributes,\n        cast(ingest_id as uuid) as ingest_id,\n        cast(reason as varchar(255)) as reason,\n        cast(effective_from as timestamptz) as effective_from,\n        cast(effective_to as timestamptz) as effective_to,\n        cast(is_current as smallint) as is_current,\n        cast(is_deleted as smallint) as is_deleted\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"sat_s3object_current\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.836805Z", "completed_at": "2025-04-09T12:57:17.843053Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.843923Z", "completed_at": "2025-04-09T12:57:17.843926Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.013475179672241211, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.sat_subject_mm", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select\n        subject_id as external_subject_id,\n        orcabus_id\n    from\n        \"orcavault\".\"ods\".\"metadata_manager_subject\"\n\n),\n\ncleaned as (\n\n    select\n        trim(regexp_replace(external_subject_id, E'[\\\\n\\\\r]+', '', 'g')) as external_subject_id,\n        trim(regexp_replace(orcabus_id, E'[\\\\n\\\\r]+', '', 'g')) as orcabus_id\n    from\n        source\n\n),\n\nencoded as (\n\n    select\n        encode(sha256(cast(external_subject_id as bytea)), 'hex') as external_subject_hk,\n        encode(sha256(concat(orcabus_id)::bytea), 'hex') as hash_diff,\n        orcabus_id\n    from\n        cleaned\n\n),\n\ndifferentiated as (\n\n    select\n        external_subject_hk,\n        hash_diff\n    from\n        encoded\n    \n    except\n    select\n        external_subject_hk,\n        hash_diff\n    from\n        \"orcavault\".\"dcl\".\"sat_subject_mm\"\n    \n\n),\n\ntransformed as (\n\n    select\n        external_subject_hk,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'metadata_manager_subject') as record_source,\n        hash_diff,\n        orcabus_id\n    from\n        encoded\n    \n    where\n        external_subject_hk in (select external_subject_hk from differentiated)\n    \n\n),\n\nfinal as (\n\n    select\n        cast(external_subject_hk as char(64)) as external_subject_hk,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(hash_diff as char(64)) as hash_diff,\n        cast(orcabus_id as varchar(255)) as orcabus_id\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"sat_subject_mm\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.839801Z", "completed_at": "2025-04-09T12:57:17.843757Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.844604Z", "completed_at": "2025-04-09T12:57:17.844606Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.005202054977416992, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.link_internal_to_external_subject", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select subject_id as internal_subject_id, external_subject_id from \"orcavault\".\"ods\".\"data_portal_labmetadata\"\n    union\n    select subject_id as internal_subject_id, external_subject_id from \"orcavault\".\"ods\".\"data_portal_limsrow\"\n    union\n    select idv.individual_id as internal_subject_id, sbj.subject_id as external_subject_id from \"orcavault\".\"ods\".\"metadata_manager_subject\" as sbj\n        join \"orcavault\".\"ods\".\"metadata_manager_subjectindividuallink\" as lnk on lnk.subject_orcabus_id = sbj.orcabus_id\n        join \"orcavault\".\"ods\".\"metadata_manager_individual\" as idv on lnk.individual_orcabus_id = idv.orcabus_id\n    union\n    select subject_id as internal_subject_id, external_subject_id from \"orcavault\".\"psa\".\"spreadsheet_library_tracking_metadata\"\n    union\n    select subject_id as internal_subject_id, external_subject_id from \"orcavault\".\"psa\".\"spreadsheet_google_lims\"\n\n),\n\ncleaned as (\n\n    select\n        distinct internal_subject_id, trim(external_subject_id) as external_subject_id\n    from\n        source\n    where\n        (internal_subject_id is not null and internal_subject_id <> '') and\n        (external_subject_id is not null and external_subject_id <> '')\n\n),\n\ndifferentiated as (\n\n    select\n        encode(sha256(cast(external_subject_id as bytea)), 'hex') as external_subject_hk,\n        encode(sha256(cast(internal_subject_id as bytea)), 'hex') as internal_subject_hk\n    from\n        cleaned\n    \n    except\n    select\n        external_subject_hk,\n        internal_subject_hk\n    from\n        \"orcavault\".\"dcl\".\"link_internal_to_external_subject\"\n    \n\n),\n\ntransformed as (\n\n    select\n        external_subject_hk,\n        internal_subject_hk,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'lab') as record_source\n    from\n        differentiated\n\n),\n\nfinal as (\n\n    select\n        cast(encode(sha256(concat(external_subject_hk, internal_subject_hk)::bytea), 'hex') as char(64)) as internal_external_subject_hk,\n        cast(external_subject_hk as char(64)) as external_subject_hk,\n        cast(internal_subject_hk as char(64)) as internal_subject_hk,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"link_internal_to_external_subject\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.845799Z", "completed_at": "2025-04-09T12:57:17.852252Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.854798Z", "completed_at": "2025-04-09T12:57:17.854802Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010622024536132812, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.sat_individual_mm", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select\n        individual_id as internal_subject_id,\n        orcabus_id,\n        source\n    from\n        \"orcavault\".\"ods\".\"metadata_manager_individual\"\n\n),\n\ncleaned as (\n\n    select\n        trim(regexp_replace(internal_subject_id, E'[\\\\n\\\\r]+', '', 'g')) as internal_subject_id,\n        trim(regexp_replace(orcabus_id, E'[\\\\n\\\\r]+', '', 'g')) as orcabus_id,\n        trim(regexp_replace(source, E'[\\\\n\\\\r]+', '', 'g')) as source\n    from\n        source\n\n),\n\nencoded as (\n\n    select\n        encode(sha256(cast(internal_subject_id as bytea)), 'hex') as internal_subject_hk,\n        encode(sha256(concat(orcabus_id, source)::bytea), 'hex') as hash_diff,\n        orcabus_id,\n        source\n    from\n        cleaned\n\n),\n\ndifferentiated as (\n\n    select\n        internal_subject_hk,\n        hash_diff\n    from\n        encoded\n    \n    except\n    select\n        internal_subject_hk,\n        hash_diff\n    from\n        \"orcavault\".\"dcl\".\"sat_individual_mm\"\n    \n\n),\n\ntransformed as (\n\n    select\n        internal_subject_hk,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'metadata_manager_individual') as record_source,\n        hash_diff,\n        orcabus_id,\n        source\n    from\n        encoded\n    \n    where\n        internal_subject_hk in (select internal_subject_hk from differentiated)\n    \n\n),\n\nfinal as (\n\n    select\n        cast(internal_subject_hk as char(64)) as internal_subject_hk,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(hash_diff as char(64)) as hash_diff,\n        cast(orcabus_id as varchar(255)) as orcabus_id,\n        cast(source as varchar(255)) as source\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"sat_individual_mm\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.852439Z", "completed_at": "2025-04-09T12:57:17.857802Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.858179Z", "completed_at": "2025-04-09T12:57:17.858181Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.01016092300415039, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.link_library_external_sample", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select library_id, external_sample_id from \"orcavault\".\"ods\".\"data_portal_labmetadata\"\n    union\n    select library_id, external_sample_id from \"orcavault\".\"ods\".\"data_portal_limsrow\"\n    union\n    select lib.library_id as library_id, smp.external_sample_id as external_sample_id from \"orcavault\".\"ods\".\"metadata_manager_library\" as lib\n        join \"orcavault\".\"ods\".\"metadata_manager_sample\" as smp on smp.orcabus_id = lib.sample_orcabus_id\n    union\n    select library_id, external_sample_id from \"orcavault\".\"psa\".\"spreadsheet_library_tracking_metadata\"\n    union\n    select library_id, external_sample_id from \"orcavault\".\"psa\".\"spreadsheet_google_lims\"\n\n),\n\ncleaned as (\n\n    select\n        distinct library_id, trim(external_sample_id) as external_sample_id\n    from\n        source\n    where\n        (library_id is not null and library_id <> '') and\n        (external_sample_id is not null and external_sample_id <> '')\n\n),\n\ndifferentiated as (\n\n    select\n        encode(sha256(cast(external_sample_id as bytea)), 'hex') as external_sample_hk,\n        encode(sha256(cast(library_id as bytea)), 'hex') as library_hk\n    from\n        cleaned\n    \n    except\n    select\n        external_sample_hk,\n        library_hk\n    from\n        \"orcavault\".\"dcl\".\"link_library_external_sample\"\n    \n\n),\n\ntransformed as (\n\n    select\n        external_sample_hk,\n        library_hk,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'lab') as record_source\n    from\n        differentiated\n\n),\n\nfinal as (\n\n    select\n        cast(encode(sha256(concat(external_sample_hk, library_hk)::bytea), 'hex') as char(64)) as library_external_sample_hk,\n        cast(external_sample_hk as char(64)) as external_sample_hk,\n        cast(library_hk as char(64)) as library_hk,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"link_library_external_sample\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.848408Z", "completed_at": "2025-04-09T12:57:17.857969Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.858582Z", "completed_at": "2025-04-09T12:57:17.858585Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.013355016708374023, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.sat_owner_contact", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select\n        *\n    from\n        \"orcavault\".\"ods\".\"metadata_manager_contact\"\n\n),\n\ncleaned as (\n\n    select\n        trim(regexp_replace(contact_id, E'[\\\\n\\\\r]+', '', 'g')) as contact_id,\n        trim(regexp_replace(orcabus_id, E'[\\\\n\\\\r]+', '', 'g')) as orcabus_id,\n        trim(regexp_replace(name, E'[\\\\n\\\\r]+', '', 'g')) as name,\n        trim(regexp_replace(description, E'[\\\\n\\\\r]+', '', 'g')) as description,\n        trim(regexp_replace(email, E'[\\\\n\\\\r]+', '', 'g')) as email\n    from\n        source\n\n),\n\nencoded as (\n\n    select\n        encode(sha256(cast(contact_id as bytea)), 'hex') as owner_hk,\n        encode(sha256(concat(orcabus_id, name, description, email)::bytea), 'hex') as hash_diff,\n        orcabus_id,\n        name,\n        description,\n        email\n    from\n        cleaned\n\n),\n\ndifferentiated as (\n\n    select\n        owner_hk,\n        hash_diff\n    from\n        encoded\n    \n    except\n    select\n        owner_hk,\n        hash_diff\n    from\n        \"orcavault\".\"dcl\".\"sat_owner_contact\"\n    \n\n),\n\ntransformed as (\n\n    select\n        owner_hk,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'metadata_manager_contact') as record_source,\n        hash_diff,\n        orcabus_id,\n        name,\n        description,\n        email\n    from\n        encoded\n    \n    where\n        owner_hk in (select owner_hk from differentiated)\n    \n\n),\n\nfinal as (\n\n    select\n        cast(owner_hk as char(64)) as owner_hk,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(hash_diff as char(64)) as hash_diff,\n        cast(orcabus_id as varchar(255)) as orcabus_id,\n        cast(name as varchar(255)) as name,\n        cast(description as varchar(255)) as description,\n        cast(email as varchar(255)) as email\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"sat_owner_contact\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.850459Z", "completed_at": "2025-04-09T12:57:17.858432Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.859074Z", "completed_at": "2025-04-09T12:57:17.859076Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.013478755950927734, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.link_library_experiment", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select library_id, experiment_id from \"orcavault\".\"ods\".\"data_portal_labmetadata\"\n    union\n    select library_id, experiment_id from \"orcavault\".\"psa\".\"spreadsheet_library_tracking_metadata\"\n\n),\n\ncleaned as (\n\n    select\n        distinct library_id, experiment_id\n    from\n        source\n    where\n        (library_id is not null and library_id <> '') and\n        (experiment_id is not null and experiment_id <> '')\n\n),\n\ndifferentiated as (\n\n    select\n        encode(sha256(cast(experiment_id as bytea)), 'hex') as experiment_hk,\n        encode(sha256(cast(library_id as bytea)), 'hex') as library_hk\n    from\n        cleaned\n    \n    except\n    select\n        experiment_hk,\n        library_hk\n    from\n        \"orcavault\".\"dcl\".\"link_library_experiment\"\n    \n\n),\n\ntransformed as (\n\n    select\n        experiment_hk,\n        library_hk,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'lab') as record_source\n    from\n        differentiated\n\n),\n\nfinal as (\n\n    select\n        cast(encode(sha256(concat(experiment_hk, library_hk)::bytea), 'hex') as char(64)) as library_experiment_hk,\n        cast(experiment_hk as char(64)) as experiment_hk,\n        cast(library_hk as char(64)) as library_hk,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"link_library_experiment\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.855719Z", "completed_at": "2025-04-09T12:57:17.859340Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.860010Z", "completed_at": "2025-04-09T12:57:17.860012Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004675865173339844, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.link_library_external_subject", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select library_id, external_subject_id from \"orcavault\".\"ods\".\"data_portal_labmetadata\"\n    union\n    select library_id, external_subject_id from \"orcavault\".\"ods\".\"data_portal_limsrow\"\n    union\n    select lib.library_id as library_id, sbj.subject_id as external_subject_id from \"orcavault\".\"ods\".\"metadata_manager_library\" as lib\n        join \"orcavault\".\"ods\".\"metadata_manager_subject\" as sbj on sbj.orcabus_id = lib.subject_orcabus_id\n    union\n    select library_id, external_subject_id from \"orcavault\".\"psa\".\"spreadsheet_library_tracking_metadata\"\n    union\n    select library_id, external_subject_id from \"orcavault\".\"psa\".\"spreadsheet_google_lims\"\n\n),\n\ncleaned as (\n\n    select\n        distinct library_id, trim(external_subject_id) as external_subject_id\n    from\n        source\n    where\n        (library_id is not null and library_id <> '') and\n        (external_subject_id is not null and external_subject_id <> '')\n\n),\n\ndifferentiated as (\n\n    select\n        encode(sha256(cast(external_subject_id as bytea)), 'hex') as external_subject_hk,\n        encode(sha256(cast(library_id as bytea)), 'hex') as library_hk\n    from\n        cleaned\n    \n    except\n    select\n        external_subject_hk,\n        library_hk\n    from\n        \"orcavault\".\"dcl\".\"link_library_external_subject\"\n    \n\n),\n\ntransformed as (\n\n    select\n        external_subject_hk,\n        library_hk,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'lab') as record_source\n    from\n        differentiated\n\n),\n\nfinal as (\n\n    select\n        cast(encode(sha256(concat(external_subject_hk, library_hk)::bytea), 'hex') as char(64)) as library_external_subject_hk,\n        cast(external_subject_hk as char(64)) as external_subject_hk,\n        cast(library_hk as char(64)) as library_hk,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"link_library_external_subject\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.861051Z", "completed_at": "2025-04-09T12:57:17.870321Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.870661Z", "completed_at": "2025-04-09T12:57:17.870664Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.011037826538085938, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.link_library_internal_subject", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select library_id, subject_id as internal_subject_id from \"orcavault\".\"ods\".\"data_portal_labmetadata\"\n    union\n    select library_id, subject_id as internal_subject_id from \"orcavault\".\"ods\".\"data_portal_limsrow\"\n    union\n    select library_id, subject_id as internal_subject_id from \"orcavault\".\"psa\".\"spreadsheet_library_tracking_metadata\"\n    union\n    select library_id, subject_id as internal_subject_id from \"orcavault\".\"psa\".\"spreadsheet_google_lims\"\n\n),\n\ncleaned as (\n\n    select\n        distinct library_id, internal_subject_id\n    from\n        source\n    where\n        (library_id is not null and library_id <> '') and\n        (internal_subject_id is not null and internal_subject_id <> '')\n\n),\n\ndifferentiated as (\n\n    select\n        encode(sha256(cast(internal_subject_id as bytea)), 'hex') as internal_subject_hk,\n        encode(sha256(cast(library_id as bytea)), 'hex') as library_hk\n    from\n        cleaned\n    \n    except\n    select\n        internal_subject_hk,\n        library_hk\n    from\n        \"orcavault\".\"dcl\".\"link_library_internal_subject\"\n    \n\n),\n\ntransformed as (\n\n    select\n        internal_subject_hk,\n        library_hk,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'lab') as record_source\n    from\n        differentiated\n\n),\n\nfinal as (\n\n    select\n        cast(encode(sha256(concat(internal_subject_hk, library_hk)::bytea), 'hex') as char(64)) as library_internal_subject_hk,\n        cast(internal_subject_hk as char(64)) as internal_subject_hk,\n        cast(library_hk as char(64)) as library_hk,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"link_library_internal_subject\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.863550Z", "completed_at": "2025-04-09T12:57:17.870489Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.870954Z", "completed_at": "2025-04-09T12:57:17.870957Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.010731935501098633, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.link_library_ownership", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select library_id, project_owner as owner_id from \"orcavault\".\"ods\".\"data_portal_labmetadata\"\n    union\n    select library_id, project_owner as owner_id from \"orcavault\".\"ods\".\"data_portal_limsrow\"\n    union\n    select library_id, project_owner as owner_id from \"orcavault\".\"psa\".\"spreadsheet_library_tracking_metadata\"\n    union\n    select library_id, project_owner as owner_id from \"orcavault\".\"psa\".\"spreadsheet_google_lims\"\n\n),\n\ncleaned as (\n\n    select\n        distinct library_id, owner_id\n    from\n        source\n    where\n        (library_id is not null and library_id <> '') and\n        (owner_id is not null and owner_id <> '')\n\n),\n\ndifferentiated as (\n\n    select\n        encode(sha256(cast(owner_id as bytea)), 'hex') as owner_hk,\n        encode(sha256(cast(library_id as bytea)), 'hex') as library_hk\n    from\n        cleaned\n    \n    except\n    select\n        owner_hk,\n        library_hk\n    from\n        \"orcavault\".\"dcl\".\"link_library_ownership\"\n    \n\n),\n\ntransformed as (\n\n    select\n        owner_hk,\n        library_hk,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'lab') as record_source\n    from\n        differentiated\n\n),\n\nfinal as (\n\n    select\n        cast(encode(sha256(concat(owner_hk, library_hk)::bytea), 'hex') as char(64)) as library_owner_hk,\n        cast(owner_hk as char(64)) as owner_hk,\n        cast(library_hk as char(64)) as library_hk,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"link_library_ownership\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.865453Z", "completed_at": "2025-04-09T12:57:17.871208Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.871859Z", "completed_at": "2025-04-09T12:57:17.871862Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.011327028274536133, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.link_library_sequencing_run", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select library_id, instrument_run_id as sequencing_run_id from \"orcavault\".\"ods\".\"data_portal_libraryrun\"\n    union\n    select library_id, illumina_id as sequencing_run_id from \"orcavault\".\"ods\".\"data_portal_limsrow\"\n    union\n    select library_id, illumina_id as sequencing_run_id from \"orcavault\".\"psa\".\"spreadsheet_google_lims\"\n    union\n    select\n        assoc.library_id as library_id, seq.instrument_run_id as sequencing_run_id\n    from \"orcavault\".\"ods\".\"sequence_run_manager_sequence\" seq\n        join \"orcavault\".\"ods\".\"sequence_run_manager_libraryassociation\" assoc on assoc.sequence_id = seq.orcabus_id\n\n),\n\ncleaned as (\n\n    select\n        distinct library_id, sequencing_run_id\n    from\n        source\n    where\n        (library_id is not null and library_id <> '') and\n        (sequencing_run_id is not null and sequencing_run_id <> '')\n\n),\n\ndifferentiated as (\n\n    select\n        encode(sha256(cast(sequencing_run_id as bytea)), 'hex') as sequencing_run_hk,\n        encode(sha256(cast(library_id as bytea)), 'hex') as library_hk\n    from\n        cleaned\n    \n    except\n    select\n        sequencing_run_hk,\n        library_hk\n    from\n        \"orcavault\".\"dcl\".\"link_library_sequencing_run\"\n    \n\n),\n\ntransformed as (\n\n    select\n        sequencing_run_hk,\n        library_hk,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'lab') as record_source\n    from\n        differentiated\n\n),\n\nfinal as (\n\n    select\n        cast(encode(sha256(concat(sequencing_run_hk, library_hk)::bytea), 'hex') as char(64)) as library_sequencing_run_hk,\n        cast(sequencing_run_hk as char(64)) as sequencing_run_hk,\n        cast(library_hk as char(64)) as library_hk,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"link_library_sequencing_run\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.867904Z", "completed_at": "2025-04-09T12:57:17.871532Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.872291Z", "completed_at": "2025-04-09T12:57:17.872293Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008955955505371094, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.link_library_workflow_run", "compiled": true, "compiled_code": "\n\nwith source1 as (\n\n    select\n        wfr.portal_run_id as portal_run_id,\n        lbr.library_id as library_id\n    from \"orcavault\".\"ods\".\"data_portal_workflow\" wfr\n        join \"orcavault\".\"ods\".\"data_portal_libraryrun_workflows\" lnk on lnk.workflow_id = wfr.id\n        join \"orcavault\".\"ods\".\"data_portal_libraryrun\" lbr on lnk.libraryrun_id = lbr.id\n    \n    where\n        cast(start as timestamptz) > ( select coalesce(max(load_datetime), '1900-01-01') as ldts from \"orcavault\".\"dcl\".\"link_library_workflow_run\" )\n    \n\n),\n\nsource2 as (\n\n    select\n        wfr.portal_run_id as portal_run_id,\n        lib.library_id as library_id\n    from \"orcavault\".\"ods\".\"workflow_manager_workflowrun\" wfr\n        join \"orcavault\".\"ods\".\"workflow_manager_libraryassociation\" lnk on lnk.workflow_run_id = wfr.orcabus_id\n        join \"orcavault\".\"ods\".\"workflow_manager_library\" lib on lnk.library_id = lib.orcabus_id\n    \n    where\n        cast(lnk.association_date as timestamptz) > ( select coalesce(max(load_datetime), '1900-01-01') as ldts from \"orcavault\".\"dcl\".\"link_library_workflow_run\" )\n    \n\n),\n\ncombined as (\n\n    select distinct portal_run_id, library_id from source1\n    union\n    select distinct portal_run_id, library_id from source2\n\n),\n\nencoded as (\n\n    select\n        encode(sha256(cast(portal_run_id as bytea)), 'hex') as workflow_run_hk,\n        encode(sha256(cast(library_id as bytea)), 'hex') as library_hk\n    from\n        combined\n\n),\n\ntransformed as (\n\n    select\n        cast(encode(sha256(concat(workflow_run_hk, library_hk)::bytea), 'hex') as char(64)) as library_workflow_run_hk,\n        workflow_run_hk,\n        library_hk,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'portal_workflow_manager') as record_source\n    from\n        encoded\n\n),\n\nfinal as (\n\n    select\n        cast(library_workflow_run_hk as char(64)) as library_workflow_run_hk,\n        cast(workflow_run_hk as char(64)) as workflow_run_hk,\n        cast(library_hk as char(64)) as library_hk,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"link_library_workflow_run\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.875532Z", "completed_at": "2025-04-09T12:57:17.881534Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.881718Z", "completed_at": "2025-04-09T12:57:17.881721Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.009222269058227539, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.sat_library_glims", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select\n        record_source,\n        library_id,\n        cast(\"timestamp\" as date) as \"timestamp\",\n        illumina_id,\n        workflow,\n        phenotype,\n        type,\n        assay,\n        quality,\n        source\n    from\n        \"orcavault\".\"psa\".\"spreadsheet_google_lims\"\n\n),\n\ncleaned as (\n\n    select\n        record_source,\n        trim(regexp_replace(library_id, E'[\\\\n\\\\r]+', '', 'g')) as library_id,\n        \"timestamp\",\n        row_number() over (partition by library_id, \"timestamp\" order by \"timestamp\" desc, illumina_id desc, workflow desc) as rank,\n        trim(regexp_replace(workflow, E'[\\\\n\\\\r]+', '', 'g')) as workflow,\n        trim(regexp_replace(phenotype, E'[\\\\n\\\\r]+', '', 'g')) as phenotype,\n        trim(regexp_replace(type, E'[\\\\n\\\\r]+', '', 'g')) as type,\n        trim(regexp_replace(assay, E'[\\\\n\\\\r]+', '', 'g')) as assay,\n        trim(regexp_replace(quality, E'[\\\\n\\\\r]+', '', 'g')) as quality,\n        trim(regexp_replace(source, E'[\\\\n\\\\r]+', '', 'g')) as source\n    from\n        source\n    where\n        library_id is not null or library_id <> ''\n\n),\n\ndifferentiated as (\n\n    select\n        *\n    from\n        cleaned\n    where\n        rank = 1\n    \n        and cast(\"timestamp\" as timestamptz) + time '11:00' > ( select coalesce(max(load_datetime), '1900-01-01') as ldts from \"orcavault\".\"dcl\".\"sat_library_glims\" )\n    \n\n),\n\nencoded as (\n\n    select\n        record_source,\n        encode(sha256(cast(library_id as bytea)), 'hex') as library_hk,\n        encode(sha256(concat(\"timestamp\", workflow, phenotype, type, assay, quality, source)::bytea), 'hex') as hash_diff,\n        \"timestamp\",\n        workflow,\n        phenotype,\n        type,\n        assay,\n        quality,\n        source\n    from\n        differentiated\n\n),\n\ntransformed as (\n\n    select\n        library_hk,\n        cast(\"timestamp\" as timestamptz) + time '11:00' as load_datetime,\n        record_source,\n        hash_diff,\n        \"timestamp\",\n        workflow,\n        phenotype,\n        type,\n        assay,\n        quality,\n        source\n    from\n        encoded\n\n),\n\nfinal as (\n\n    select\n        cast(library_hk as char(64)) as library_hk,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(hash_diff as char(64)) as hash_diff,\n        cast(\"timestamp\" as date) as \"timestamp\",\n        cast(workflow as varchar(255)) as workflow,\n        cast(phenotype as varchar(255)) as phenotype,\n        cast(type as varchar(255)) as type,\n        cast(assay as varchar(255)) as assay,\n        cast(quality as varchar(255)) as quality,\n        cast(source as varchar(255)) as source\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"sat_library_glims\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.873520Z", "completed_at": "2025-04-09T12:57:17.882163Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.882561Z", "completed_at": "2025-04-09T12:57:17.882564Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.010475873947143555, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.sat_library_glab", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select distinct\n        record_source,\n        library_id,\n        workflow,\n        phenotype,\n        type,\n        assay,\n        quality,\n        source,\n        truseq_index\n    from\n        \"orcavault\".\"psa\".\"spreadsheet_library_tracking_metadata\"\n\n),\n\ncleaned as (\n\n    select\n        record_source,\n        row_number() over (partition by library_id order by phenotype) as rank,\n        trim(regexp_replace(library_id, E'[\\\\n\\\\r]+', '', 'g')) as library_id,\n        trim(regexp_replace(workflow, E'[\\\\n\\\\r]+', '', 'g')) as workflow,\n        trim(regexp_replace(phenotype, E'[\\\\n\\\\r]+', '', 'g')) as phenotype,\n        trim(regexp_replace(type, E'[\\\\n\\\\r]+', '', 'g')) as type,\n        trim(regexp_replace(assay, E'[\\\\n\\\\r]+', '', 'g')) as assay,\n        trim(regexp_replace(quality, E'[\\\\n\\\\r]+', '', 'g')) as quality,\n        trim(regexp_replace(source, E'[\\\\n\\\\r]+', '', 'g')) as source,\n        trim(regexp_replace(truseq_index, E'[\\\\n\\\\r]+', '', 'g')) as truseq_index\n    from\n        source\n    where\n        library_id is not null or library_id <> ''\n\n),\n\nencoded as (\n\n    select\n        record_source,\n        encode(sha256(cast(library_id as bytea)), 'hex') as library_hk,\n        encode(sha256(concat(workflow, phenotype, type, assay, quality, source, truseq_index)::bytea), 'hex') as hash_diff,\n        workflow,\n        phenotype,\n        type,\n        assay,\n        quality,\n        source,\n        truseq_index\n    from\n        cleaned\n    where\n        rank = 1\n\n),\n\ndifferentiated as (\n\n    select\n        library_hk,\n        hash_diff\n    from\n        encoded\n    \n    except\n    select\n        library_hk,\n        hash_diff\n    from\n        \"orcavault\".\"dcl\".\"sat_library_glab\"\n    \n\n),\n\ntransformed as (\n\n    select\n        library_hk,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        record_source,\n        hash_diff,\n        workflow,\n        phenotype,\n        type,\n        assay,\n        quality,\n        source,\n        truseq_index\n    from\n        encoded\n    \n    where\n        library_hk in (select library_hk from differentiated)\n    \n\n),\n\nfinal as (\n\n    select\n        cast(library_hk as char(64)) as library_hk,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(hash_diff as char(64)) as hash_diff,\n        cast(workflow as varchar(255)) as workflow,\n        cast(phenotype as varchar(255)) as phenotype,\n        cast(type as varchar(255)) as type,\n        cast(assay as varchar(255)) as assay,\n        cast(quality as varchar(255)) as quality,\n        cast(source as varchar(255)) as source,\n        cast(truseq_index as varchar(255)) as truseq_index\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"sat_library_glab\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.877654Z", "completed_at": "2025-04-09T12:57:17.882832Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.883475Z", "completed_at": "2025-04-09T12:57:17.883477Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.010148286819458008, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.sat_library_mm", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select\n        library_id,\n        orcabus_id,\n        workflow,\n        phenotype,\n        type,\n        assay,\n        quality\n    from\n        \"orcavault\".\"ods\".\"metadata_manager_library\"\n\n),\n\ncleaned as (\n\n    select\n        trim(regexp_replace(library_id, E'[\\\\n\\\\r]+', '', 'g')) as library_id,\n        trim(regexp_replace(orcabus_id, E'[\\\\n\\\\r]+', '', 'g')) as orcabus_id,\n        trim(regexp_replace(workflow, E'[\\\\n\\\\r]+', '', 'g')) as workflow,\n        trim(regexp_replace(phenotype, E'[\\\\n\\\\r]+', '', 'g')) as phenotype,\n        trim(regexp_replace(type, E'[\\\\n\\\\r]+', '', 'g')) as type,\n        trim(regexp_replace(assay, E'[\\\\n\\\\r]+', '', 'g')) as assay,\n        trim(regexp_replace(quality, E'[\\\\n\\\\r]+', '', 'g')) as quality\n    from\n        source\n\n),\n\nencoded as (\n\n    select\n        encode(sha256(cast(library_id as bytea)), 'hex') as library_hk,\n        encode(sha256(concat(orcabus_id, workflow, phenotype, type, assay, quality)::bytea), 'hex') as hash_diff,\n        orcabus_id,\n        workflow,\n        phenotype,\n        type,\n        assay,\n        quality\n    from\n        cleaned\n\n),\n\ndifferentiated as (\n\n    select\n        library_hk,\n        hash_diff\n    from\n        encoded\n    \n    except\n    select\n        library_hk,\n        hash_diff\n    from\n        \"orcavault\".\"dcl\".\"sat_library_mm\"\n    \n\n),\n\ntransformed as (\n\n    select\n        library_hk,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'metadata_manager') as record_source,\n        hash_diff,\n        orcabus_id,\n        workflow,\n        phenotype,\n        type,\n        assay,\n        quality\n    from\n        encoded\n    \n    where\n        library_hk in (select library_hk from differentiated)\n    \n\n),\n\nfinal as (\n\n    select\n        cast(library_hk as char(64)) as library_hk,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(hash_diff as char(64)) as hash_diff,\n        cast(orcabus_id as varchar(255)) as orcabus_id,\n        cast(workflow as varchar(255)) as workflow,\n        cast(phenotype as varchar(255)) as phenotype,\n        cast(type as varchar(255)) as type,\n        cast(assay as varchar(255)) as assay,\n        cast(quality as varchar(255)) as quality\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"sat_library_mm\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.879459Z", "completed_at": "2025-04-09T12:57:17.882990Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.883717Z", "completed_at": "2025-04-09T12:57:17.883720Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00839090347290039, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.sat_library_plab", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select\n        library_id,\n        workflow,\n        phenotype,\n        type,\n        assay,\n        quality,\n        source,\n        truseqindex\n    from\n        \"orcavault\".\"ods\".\"data_portal_labmetadata\"\n\n),\n\ncleaned as (\n\n    select\n        trim(regexp_replace(library_id, E'[\\\\n\\\\r]+', '', 'g')) as library_id,\n        trim(regexp_replace(workflow, E'[\\\\n\\\\r]+', '', 'g')) as workflow,\n        trim(regexp_replace(phenotype, E'[\\\\n\\\\r]+', '', 'g')) as phenotype,\n        trim(regexp_replace(type, E'[\\\\n\\\\r]+', '', 'g')) as type,\n        trim(regexp_replace(assay, E'[\\\\n\\\\r]+', '', 'g')) as assay,\n        trim(regexp_replace(quality, E'[\\\\n\\\\r]+', '', 'g')) as quality,\n        trim(regexp_replace(source, E'[\\\\n\\\\r]+', '', 'g')) as source,\n        trim(regexp_replace(truseqindex, E'[\\\\n\\\\r]+', '', 'g')) as truseqindex\n    from\n        source\n\n),\n\nencoded as (\n\n    select\n        encode(sha256(cast(library_id as bytea)), 'hex') as library_hk,\n        encode(sha256(concat(workflow, phenotype, type, assay, quality, source, truseqindex)::bytea), 'hex') as hash_diff,\n        workflow,\n        phenotype,\n        type,\n        assay,\n        quality,\n        source,\n        truseqindex\n    from\n        cleaned\n\n),\n\ndifferentiated as (\n\n    select\n        library_hk,\n        hash_diff\n    from\n        encoded\n    \n    except\n    select\n        library_hk,\n        hash_diff\n    from\n        \"orcavault\".\"dcl\".\"sat_library_plab\"\n    \n\n),\n\ntransformed as (\n\n    select\n        library_hk,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'data_portal_labmetadata') as record_source,\n        hash_diff,\n        workflow,\n        phenotype,\n        type,\n        assay,\n        quality,\n        source,\n        truseqindex\n    from\n        encoded\n    \n    where\n        library_hk in (select library_hk from differentiated)\n    \n\n),\n\nfinal as (\n    select\n        cast(library_hk as char(64)) as library_hk,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(hash_diff as char(64)) as hash_diff,\n        cast(workflow as varchar(255)) as workflow,\n        cast(phenotype as varchar(255)) as phenotype,\n        cast(type as varchar(255)) as type,\n        cast(assay as varchar(255)) as assay,\n        cast(quality as varchar(255)) as quality,\n        cast(source as varchar(255)) as source,\n        cast(truseqindex as varchar(255)) as truseqindex\n    from\n        transformed\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"sat_library_plab\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.883975Z", "completed_at": "2025-04-09T12:57:17.890749Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.893461Z", "completed_at": "2025-04-09T12:57:17.893465Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.011176824569702148, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.sat_library_plims", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select\n        library_id,\n        cast(\"timestamp\" as date) as \"timestamp\",\n        illumina_id,\n        workflow,\n        phenotype,\n        type,\n        assay,\n        quality,\n        source\n    from\n        \"orcavault\".\"ods\".\"data_portal_limsrow\"\n\n),\n\ncleaned as (\n\n    select\n        trim(regexp_replace(library_id, E'[\\\\n\\\\r]+', '', 'g')) as library_id,\n        \"timestamp\",\n        row_number() over (partition by library_id, \"timestamp\" order by \"timestamp\" desc, illumina_id desc) as rank,\n        trim(regexp_replace(workflow, E'[\\\\n\\\\r]+', '', 'g')) as workflow,\n        trim(regexp_replace(phenotype, E'[\\\\n\\\\r]+', '', 'g')) as phenotype,\n        trim(regexp_replace(type, E'[\\\\n\\\\r]+', '', 'g')) as type,\n        trim(regexp_replace(assay, E'[\\\\n\\\\r]+', '', 'g')) as assay,\n        trim(regexp_replace(quality, E'[\\\\n\\\\r]+', '', 'g')) as quality,\n        trim(regexp_replace(source, E'[\\\\n\\\\r]+', '', 'g')) as source\n    from\n        source\n\n),\n\ndifferentiated as (\n\n    select\n        *\n    from\n        cleaned\n    where\n        rank = 1\n    \n        and cast(\"timestamp\" as timestamptz) + time '11:00' > ( select coalesce(max(load_datetime), '1900-01-01') as ldts from \"orcavault\".\"dcl\".\"sat_library_plims\" )\n    \n\n),\n\nencoded as (\n\n    select\n        encode(sha256(cast(library_id as bytea)), 'hex') as library_hk,\n        encode(sha256(concat(\"timestamp\", workflow, phenotype, type, assay, quality, source)::bytea), 'hex') as hash_diff,\n        \"timestamp\",\n        workflow,\n        phenotype,\n        type,\n        assay,\n        quality,\n        source\n    from\n        differentiated\n\n),\n\ntransformed as (\n\n    select\n        library_hk,\n        cast(\"timestamp\" as timestamptz) + time '11:00' as load_datetime,\n        (select 'data_portal_limsrow') as record_source,\n        hash_diff,\n        \"timestamp\",\n        workflow,\n        phenotype,\n        type,\n        assay,\n        quality,\n        source\n    from\n        encoded\n\n),\n\nfinal as (\n\n    select\n        cast(library_hk as char(64)) as library_hk,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(hash_diff as char(64)) as hash_diff,\n        cast(\"timestamp\" as date) as \"timestamp\",\n        cast(workflow as varchar(255)) as workflow,\n        cast(phenotype as varchar(255)) as phenotype,\n        cast(type as varchar(255)) as type,\n        cast(assay as varchar(255)) as assay,\n        cast(quality as varchar(255)) as quality,\n        cast(source as varchar(255)) as source\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"sat_library_plims\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.886842Z", "completed_at": "2025-04-09T12:57:17.896548Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.896985Z", "completed_at": "2025-04-09T12:57:17.896988Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.011366844177246094, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.link_internal_to_external_sample", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select sample_id, external_sample_id from \"orcavault\".\"ods\".\"data_portal_labmetadata\"\n    union\n    select sample_id, external_sample_id from \"orcavault\".\"ods\".\"data_portal_limsrow\"\n    union\n    select sample_id, external_sample_id from \"orcavault\".\"ods\".\"metadata_manager_sample\"\n    union\n    select sample_id, external_sample_id from \"orcavault\".\"psa\".\"spreadsheet_library_tracking_metadata\"\n    union\n    select sample_id, external_sample_id from \"orcavault\".\"psa\".\"spreadsheet_google_lims\"\n\n),\n\ncleaned as (\n\n    select\n        distinct sample_id, trim(external_sample_id) as external_sample_id\n    from\n        source\n    where\n        (sample_id is not null and sample_id <> '') and\n        (external_sample_id is not null and external_sample_id <> '')\n\n),\n\ndifferentiated as (\n\n    select\n        encode(sha256(cast(external_sample_id as bytea)), 'hex') as external_sample_hk,\n        encode(sha256(cast(sample_id as bytea)), 'hex') as sample_hk\n    from\n        cleaned\n    \n    except\n    select\n        external_sample_hk,\n        sample_hk\n    from\n        \"orcavault\".\"dcl\".\"link_internal_to_external_sample\"\n    \n\n),\n\ntransformed as (\n\n    select\n        external_sample_hk,\n        sample_hk,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'lab') as record_source\n    from\n        differentiated\n\n),\n\nfinal as (\n\n    select\n        cast(encode(sha256(concat(external_sample_hk, sample_hk)::bytea), 'hex') as char(64)) as internal_external_sample_hk,\n        cast(external_sample_hk as char(64)) as external_sample_hk,\n        cast(sample_hk as char(64)) as sample_hk,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"link_internal_to_external_sample\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.891116Z", "completed_at": "2025-04-09T12:57:17.897275Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.897933Z", "completed_at": "2025-04-09T12:57:17.897937Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.011532783508300781, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.link_library_sample", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select library_id, sample_id from \"orcavault\".\"ods\".\"data_portal_limsrow\"\n    union\n    select library_id, sample_id from \"orcavault\".\"ods\".\"data_portal_labmetadata\"\n    union\n    select library_id, smp.sample_id as sample_id from \"orcavault\".\"ods\".\"metadata_manager_library\" as lib\n        join \"orcavault\".\"ods\".\"metadata_manager_sample\" as smp on lib.sample_orcabus_id = smp.orcabus_id\n    union\n    select library_id, sample_id from \"orcavault\".\"psa\".\"spreadsheet_library_tracking_metadata\"\n    union\n    select library_id, sample_id from \"orcavault\".\"psa\".\"spreadsheet_google_lims\"\n\n),\n\ncleaned as (\n\n    select\n        distinct library_id, sample_id\n    from\n        source\n    where\n        (library_id is not null and library_id <> '') and\n        (sample_id is not null and sample_id <> '')\n\n),\n\ndifferentiated as (\n\n    select\n        encode(sha256(cast(sample_id as bytea)), 'hex') as sample_hk,\n        encode(sha256(cast(library_id as bytea)), 'hex') as library_hk\n    from\n        cleaned\n    \n    except\n    select\n        sample_hk,\n        library_hk\n    from\n        \"orcavault\".\"dcl\".\"link_library_sample\"\n    \n\n),\n\ntransformed as (\n\n    select\n        sample_hk,\n        library_hk,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'lab') as record_source\n    from\n        differentiated\n\n),\n\nfinal as (\n\n    select\n        cast(encode(sha256(concat(sample_hk, library_hk)::bytea), 'hex') as char(64)) as library_sample_hk,\n        cast(sample_hk as char(64)) as sample_hk,\n        cast(library_hk as char(64)) as library_hk,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"link_library_sample\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.893800Z", "completed_at": "2025-04-09T12:57:17.897598Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.900934Z", "completed_at": "2025-04-09T12:57:17.900937Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.014322042465209961, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.link_library_project", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select library_id, project_name as project_id from \"orcavault\".\"ods\".\"data_portal_labmetadata\"\n    union\n    select library_id, project_name as project_id from \"orcavault\".\"ods\".\"data_portal_limsrow\"\n    union\n    select lib.library_id as library_id, prj.project_id as project_id from \"orcavault\".\"ods\".\"metadata_manager_library\" as lib\n        join \"orcavault\".\"ods\".\"metadata_manager_libraryprojectlink\" as lnk on lnk.library_orcabus_id = lib.orcabus_id\n        join \"orcavault\".\"ods\".\"metadata_manager_project\" as prj on lnk.project_orcabus_id = prj.orcabus_id\n    union\n    select library_id, project_name as project_id from \"orcavault\".\"psa\".\"spreadsheet_library_tracking_metadata\"\n    union\n    select library_id, project_name as project_id from \"orcavault\".\"psa\".\"spreadsheet_google_lims\"\n\n),\n\ncleaned as (\n\n    select\n        distinct library_id, project_id\n    from\n        source\n    where\n        (library_id is not null and library_id <> '') and\n        (project_id is not null and project_id <> '')\n\n),\n\ndifferentiated as (\n\n    select\n        encode(sha256(cast(project_id as bytea)), 'hex') as project_hk,\n        encode(sha256(cast(library_id as bytea)), 'hex') as library_hk\n    from\n        cleaned\n    \n    except\n    select\n        project_hk,\n        library_hk\n    from\n        \"orcavault\".\"dcl\".\"link_library_project\"\n    \n\n),\n\ntransformed as (\n\n    select\n        project_hk,\n        library_hk,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'lab') as record_source\n    from\n        differentiated\n\n),\n\nfinal as (\n\n    select\n        cast(encode(sha256(concat(project_hk, library_hk)::bytea), 'hex') as char(64)) as library_project_hk,\n        cast(project_hk as char(64)) as project_hk,\n        cast(library_hk as char(64)) as library_hk,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"link_library_project\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.898220Z", "completed_at": "2025-04-09T12:57:17.904212Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.904699Z", "completed_at": "2025-04-09T12:57:17.904703Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007970094680786133, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.link_project_ownership", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select project_name as project_id, project_owner as owner_id from \"orcavault\".\"ods\".\"data_portal_labmetadata\"\n    union\n    select project_name as project_id, project_owner as owner_id from \"orcavault\".\"ods\".\"data_portal_limsrow\"\n    union\n    select project_id, contact_id as owner_id from \"orcavault\".\"ods\".\"metadata_manager_project\" as prj\n        join \"orcavault\".\"ods\".\"metadata_manager_projectcontactlink\" as lnk on lnk.project_orcabus_id = prj.orcabus_id\n        join \"orcavault\".\"ods\".\"metadata_manager_contact\" as cnt on lnk.contact_orcabus_id = cnt.orcabus_id\n    union\n    select project_name as project_id, project_owner as owner_id from \"orcavault\".\"psa\".\"spreadsheet_library_tracking_metadata\"\n    union\n    select project_name as project_id, project_owner as owner_id from \"orcavault\".\"psa\".\"spreadsheet_google_lims\"\n\n),\n\ncleaned as (\n\n    select\n        distinct trim(project_id) as project_id, trim(owner_id) as owner_id\n    from\n        source\n    where\n        (project_id is not null and project_id <> '') and\n        (owner_id is not null and owner_id <> '')\n\n),\n\ndifferentiated as (\n\n    select\n        encode(sha256(cast(owner_id as bytea)), 'hex') as owner_hk,\n        encode(sha256(cast(project_id as bytea)), 'hex') as project_hk\n    from\n        cleaned\n    \n    except\n    select\n        owner_hk,\n        project_hk\n    from\n        \"orcavault\".\"dcl\".\"link_project_ownership\"\n    \n\n),\n\ntransformed as (\n\n    select\n        owner_hk,\n        project_hk,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'lab') as record_source\n    from\n        differentiated\n\n),\n\nfinal as (\n\n    select\n        cast(encode(sha256(concat(owner_hk, project_hk)::bytea), 'hex') as char(64)) as project_owner_hk,\n        cast(owner_hk as char(64)) as owner_hk,\n        cast(project_hk as char(64)) as project_hk,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"link_project_ownership\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.902368Z", "completed_at": "2025-04-09T12:57:17.910359Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.910812Z", "completed_at": "2025-04-09T12:57:17.910815Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.009618997573852539, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.sat_project_mm", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select\n        *\n    from\n        \"orcavault\".\"ods\".\"metadata_manager_project\"\n\n),\n\ncleaned as (\n\n    select\n        trim(regexp_replace(project_id, E'[\\\\n\\\\r]+', '', 'g')) as project_id,\n        trim(regexp_replace(orcabus_id, E'[\\\\n\\\\r]+', '', 'g')) as orcabus_id,\n        trim(regexp_replace(name, E'[\\\\n\\\\r]+', '', 'g')) as name,\n        trim(regexp_replace(description, E'[\\\\n\\\\r]+', '', 'g')) as description\n    from\n        source\n\n),\n\nencoded as (\n\n    select\n        encode(sha256(cast(project_id as bytea)), 'hex') as project_hk,\n        encode(sha256(concat(orcabus_id, name, description)::bytea), 'hex') as hash_diff,\n        orcabus_id,\n        name,\n        description\n    from\n        cleaned\n\n),\n\ndifferentiated as (\n\n    select\n        project_hk,\n        hash_diff\n    from\n        encoded\n    \n    except\n    select\n        project_hk,\n        hash_diff\n    from\n        \"orcavault\".\"dcl\".\"sat_project_mm\"\n    \n\n),\n\ntransformed as (\n\n    select\n        project_hk,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'metadata_manager_project') as record_source,\n        hash_diff,\n        orcabus_id,\n        name,\n        description\n    from\n        encoded\n    \n    where\n        project_hk in (select project_hk from differentiated)\n    \n\n),\n\nfinal as (\n\n    select\n        cast(project_hk as char(64)) as project_hk,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(hash_diff as char(64)) as hash_diff,\n        cast(orcabus_id as varchar(255)) as orcabus_id,\n        cast(name as varchar(255)) as name,\n        cast(description as varchar(255)) as description\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"sat_project_mm\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.904980Z", "completed_at": "2025-04-09T12:57:17.911493Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.913323Z", "completed_at": "2025-04-09T12:57:17.913327Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.011377334594726562, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.bam", "compiled": true, "compiled_code": "\n\nwith transformed as (\n\n    select\n        (regexp_match(hub.key, '(?:/)(\\d{8}[a-zA-Z0-9]{8})(?:/)'))[1] as portal_run_id,\n        (regexp_match(hub.key, '(?<=byob-icav2\\/).+?(?=\\/)'))[1] as cohort_id,\n        hub.bucket as bucket,\n        hub.key as \"key\",\n        sat.library_id as library_id,\n        sat.filename as filename,\n        sat.ext1 as format,\n        cur.size as \"size\",\n        cur.storage_class as storage_class,\n        cur.e_tag as e_tag,\n        cur.last_modified_date as last_modified_date\n    from \"orcavault\".\"dcl\".\"hub_s3object\" hub\n        join \"orcavault\".\"dcl\".\"sat_s3object_by_library\" sat on sat.s3object_hk = hub.s3object_hk\n        join \"orcavault\".\"dcl\".\"sat_s3object_current\" cur on cur.s3object_hk = hub.s3object_hk\n    where\n        (sat.ext1 = 'bam' or sat.ext1 = 'bai')\n        and cur.is_current = 1\n        and cur.is_deleted = 0\n\n),\n\nfinal as (\n\n    select\n        cast(portal_run_id as char(16)) as portal_run_id,\n        cast(cohort_id as varchar(255)) as cohort_id,\n        cast(bucket as varchar(255)) as bucket,\n        cast(\"key\" as text) as \"key\",\n        cast(library_id as varchar(255)) as library_id,\n        cast(filename as text) as filename,\n        cast(format as varchar(255)) as format,\n        cast(\"size\" as bigint) as \"size\",\n        cast(storage_class as varchar(255)) as storage_class,\n        cast(e_tag as varchar(255)) as e_tag,\n        cast(last_modified_date as timestamptz) as last_modified_date\n    from\n        transformed\n    order by portal_run_id desc nulls last, library_id desc\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"mart\".\"bam\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.907562Z", "completed_at": "2025-04-09T12:57:17.912963Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.913615Z", "completed_at": "2025-04-09T12:57:17.913618Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.011467218399047852, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.fastq", "compiled": true, "compiled_code": "\n\nwith transformed as (\n\n    select\n        sat.sequencing_run_id as sequencing_run_id,\n        cast((regexp_match(sat.sequencing_run_id, '(?:^)(\\d{6})(?:_A\\d{5}_\\d{4}_[A-Z0-9]{10})'))[1] as date) as sequencing_run_date,\n        sat.portal_run_id as portal_run_id,\n        (regexp_match(hub.key, '(?<=byob-icav2\\/).+?(?=\\/)'))[1] as cohort_id,\n        hub.bucket as bucket,\n        hub.key as \"key\",\n        (regexp_match(sat.filename, '(?:L\\d{7}|L(?:PRJ|CCR|MDX|TGX)\\d{6}|Undetermined)(?:(?:_topup\\d?)|(?:_rerun\\d?))?'))[1] as library_id,\n        sat.filename as filename,\n        sat.ext1 as format,\n        cur.size as \"size\",\n        cur.storage_class as storage_class,\n        cur.e_tag as e_tag,\n        cur.last_modified_date as last_modified_date\n    from \"orcavault\".\"dcl\".\"hub_s3object\" hub\n        join \"orcavault\".\"dcl\".\"sat_s3object_by_run\" sat on sat.s3object_hk = hub.s3object_hk\n        join \"orcavault\".\"dcl\".\"sat_s3object_current\" cur on cur.s3object_hk = hub.s3object_hk\n    where\n        (sat.ext1 = 'gz' or sat.ext1 = 'ora')\n        and sat.ext2 = 'fastq'\n        and cur.is_current = 1\n        and cur.is_deleted = 0\n\n),\n\nfinal as (\n\n    select\n        cast(sequencing_run_id as varchar(255)) as sequencing_run_id,\n        cast(sequencing_run_date as date) as sequencing_run_date,\n        cast(portal_run_id as char(16)) as portal_run_id,\n        cast(cohort_id as varchar(255)) as cohort_id,\n        cast(bucket as varchar(255)) as bucket,\n        cast(\"key\" as text) as \"key\",\n        cast(library_id as varchar(255)) as library_id,\n        cast(filename as text) as filename,\n        cast(format as varchar(255)) as format,\n        cast(\"size\" as bigint) as \"size\",\n        cast(storage_class as varchar(255)) as storage_class,\n        cast(e_tag as varchar(255)) as e_tag,\n        cast(last_modified_date as timestamptz) as last_modified_date\n    from\n        transformed\n    order by sequencing_run_date desc nulls last, library_id desc\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"mart\".\"fastq\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.911666Z", "completed_at": "2025-04-09T12:57:17.917670Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.918185Z", "completed_at": "2025-04-09T12:57:17.918187Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0076100826263427734, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.fastq_history", "compiled": true, "compiled_code": "\n\nwith transformed as (\n\n    select\n        hub.bucket as bucket,\n        hub.key as \"key\",\n        effsat.effective_from as effective_from,\n        effsat.effective_to as effective_to,\n        effsat.is_current as is_current,\n        effsat.is_deleted as is_deleted,\n        effsat.reason as reason,\n        effsat.storage_class as storage_class,\n        (regexp_match(hub.\"key\", '(?:/)(\\d{8}[a-zA-Z0-9]{8})(?:/)'))[1] as portal_run_id,\n        (regexp_match(hub.key, '(?<=byob-icav2\\/).+?(?=\\/)'))[1] as cohort_id,\n        (regexp_match(hub.\"key\", '(?:/)(\\d{6}_A\\d{5}_\\d{4}_[A-Z0-9]{10})(?:/)'))[1] as sequencing_run_id,\n        sat.library_id as library_id,\n        sat.filename as filename,\n        sat.ext1 as ext1,\n        sat.ext2 as ext2,\n        sat.ext3 as ext3,\n        effsat.size as \"size\",\n        effsat.e_tag as e_tag,\n        effsat.last_modified_date as last_modified_date,\n        effsat.attributes as filemanager_annotated_attributes,\n        effsat.ingest_id as filemanager_ingest_id,\n        effsat.s3_object_id as filemanager_s3object_id\n    from \"orcavault\".\"dcl\".\"hub_s3object\" hub\n        join \"orcavault\".\"dcl\".\"sat_s3object_by_library\" sat on sat.s3object_hk = hub.s3object_hk\n        join \"orcavault\".\"dcl\".\"sat_s3object_current\" effsat on effsat.s3object_hk = hub.s3object_hk\n    where\n        sat.ext2 = 'fastq'\n\n),\n\nfinal as (\n\n    select\n        cast(bucket as varchar(255)) as bucket,\n        cast(\"key\" as text) as \"key\",\n        cast(effective_from as timestamptz) as effective_from,\n        cast(effective_to as timestamptz) as effective_to,\n        cast(is_current as smallint) as is_current,\n        cast(is_deleted as smallint) as is_deleted,\n        cast(reason as varchar(255)) as reason,\n        cast(storage_class as varchar(255)) as storage_class,\n        cast(portal_run_id as char(16)) as portal_run_id,\n        cast(cohort_id as varchar(255)) as cohort_id,\n        cast(sequencing_run_id as varchar(255)) as sequencing_run_id,\n        cast(library_id as varchar(255)) as library_id,\n        cast(filename as text) as filename,\n        cast(ext1 as varchar(255)) as ext1,\n        cast(ext2 as varchar(255)) as ext2,\n        cast(ext3 as varchar(255)) as ext3,\n        cast(\"size\" as bigint) as \"size\",\n        cast(e_tag as varchar(255)) as e_tag,\n        cast(last_modified_date as timestamptz) as last_modified_date,\n        cast(filemanager_annotated_attributes as jsonb) as filemanager_annotated_attributes,\n        cast(filemanager_ingest_id as uuid) as filemanager_ingest_id,\n        cast(filemanager_s3object_id as uuid) as filemanager_s3object_id\n    from\n        transformed\n    order by effective_from\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"mart\".\"fastq_history\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.914412Z", "completed_at": "2025-04-09T12:57:17.922473Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.924543Z", "completed_at": "2025-04-09T12:57:17.924547Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.01146697998046875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.effsat_library_experiment", "compiled": true, "compiled_code": "\n\nwith incremental as (\n\n    select\n        hl.library_hk as library_hk,\n        hl.library_id as library_id,\n        he.experiment_id as experiment_id,\n        lnk.library_experiment_hk as library_experiment_hk,\n        lnk.record_source as record_source,\n        cast(he.last_seen_datetime as timestamptz) as experiment_last_seen_datetime,\n        row_number() over (partition by hl.library_hk order by he.last_seen_datetime desc) as rank\n    from \"orcavault\".\"dcl\".\"hub_library\" hl\n        join \"orcavault\".\"dcl\".\"link_library_experiment\" lnk on lnk.library_hk = hl.library_hk\n        join \"orcavault\".\"dcl\".\"hub_experiment\" he on he.experiment_hk = lnk.experiment_hk\n    \n    where\n        cast(lnk.load_datetime as timestamptz) > ( select coalesce(max(load_datetime), '1900-01-01') as ldts from \"orcavault\".\"dcl\".\"effsat_library_experiment\" )\n    \n\n),\n\ntransformed as (\n\n    select\n        library_experiment_hk,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        record_source,\n        encode(sha256(concat(\n            library_id,\n            experiment_id\n        )::bytea), 'hex') as hash_diff,\n        library_id,\n        experiment_id,\n        cast(experiment_last_seen_datetime as timestamptz) as effective_from,\n        case\n            when (rank = 1) then\n                cast('9999-12-31' as date)\n            else\n                lag(experiment_last_seen_datetime) over (partition by library_hk order by rank)\n            end as effective_to,\n        case when (rank = 1) then 1 else 0 end as is_current\n    from\n        incremental\n\n),\n\nfinal as (\n\n    select\n        cast(library_experiment_hk as varchar(64)) as library_experiment_hk,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(hash_diff as varchar(64)) as hash_diff,\n        cast(library_id as varchar(255)) as library_id,\n        cast(experiment_id as varchar(255)) as experiment_id,\n        cast(effective_from as timestamptz) as effective_from,\n        cast(effective_to as timestamptz) as effective_to,\n        cast(is_current as smallint) as is_current\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"effsat_library_experiment\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.918441Z", "completed_at": "2025-04-09T12:57:17.925396Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.927434Z", "completed_at": "2025-04-09T12:57:17.927437Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.010178089141845703, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.effsat_library_external_subject", "compiled": true, "compiled_code": "\n\nwith incremental as (\n\n    select\n        distinct l.library_id\n    from \"orcavault\".\"ods\".\"metadata_manager_historicallibrary\" l\n        join \"orcavault\".\"ods\".\"metadata_manager_subject\" s on s.orcabus_id = l.subject_orcabus_id\n    \n    where\n        cast(l.history_date as timestamptz) > ( select coalesce(max(load_datetime), '1900-01-01') as ldts from \"orcavault\".\"dcl\".\"effsat_library_external_subject\" )\n    \n\n    union\n\n    select\n        distinct library_id\n    from \"orcavault\".\"psa\".\"spreadsheet_library_tracking_metadata\"\n    where\n        (library_id is not null or library_id <> '') and\n        (external_subject_id is not null or external_subject_id <> '')\n    \n    and\n        cast(load_datetime as timestamptz) > ( select coalesce(max(load_datetime), '1900-01-01') as ldts from \"orcavault\".\"dcl\".\"effsat_library_external_subject\" )\n    \n\n    union\n\n    select\n        distinct library_id\n    from \"orcavault\".\"psa\".\"spreadsheet_google_lims\"\n    where\n        (library_id is not null or library_id <> '') and\n        (external_subject_id is not null or external_subject_id <> '')\n    \n    and\n        cast(\"timestamp\" as timestamptz) + time '11:00' > ( select coalesce(max(load_datetime), '1900-01-01') as ldts from \"orcavault\".\"dcl\".\"effsat_library_external_subject\" )\n    \n\n),\n\nhistory as (\n\n    select\n        l.library_id as library_id,\n        s.subject_id as external_subject_id,\n        l.history_date as association_date,\n        (select 'metadata_manager_historicallibrary') as record_source\n    from \"orcavault\".\"ods\".\"metadata_manager_historicallibrary\" l\n        join \"orcavault\".\"ods\".\"metadata_manager_subject\" s on s.orcabus_id = l.subject_orcabus_id\n        join incremental i on i.library_id = l.library_id\n\n    union\n\n    select\n        ss.library_id,\n        ss.external_subject_id,\n        ss.load_datetime as association_date,\n        ss.record_source\n    from \"orcavault\".\"psa\".\"spreadsheet_library_tracking_metadata\" ss\n        join incremental i on i.library_id = ss.library_id\n    where\n        (ss.library_id is not null or ss.library_id <> '') and\n        (ss.external_subject_id is not null or ss.external_subject_id <> '')\n\n    union\n\n    select\n        gg.library_id,\n        gg.external_subject_id,\n        cast(gg.\"timestamp\" as timestamptz) + time '11:00' as association_date,\n        gg.record_source\n    from \"orcavault\".\"psa\".\"spreadsheet_google_lims\" gg\n        join incremental i on i.library_id = gg.library_id\n    where\n        (gg.library_id is not null or gg.library_id <> '') and\n        (gg.external_subject_id is not null or gg.external_subject_id <> '')\n\n),\n\nlinked as (\n\n    select\n        lnk.library_external_subject_hk as library_external_subject_hk,\n        hl.library_id as library_id,\n        hes.external_subject_id as external_subject_id\n    from \"orcavault\".\"dcl\".\"hub_library\" hl\n        join \"orcavault\".\"dcl\".\"link_library_external_subject\" lnk on lnk.library_hk = hl.library_hk\n        join \"orcavault\".\"dcl\".\"hub_external_subject\" hes on lnk.external_subject_hk = hes.external_subject_hk\n\n),\n\nmerged as (\n\n    select\n        linked.library_external_subject_hk as library_external_subject_hk,\n        linked.library_id as library_id,\n        linked.external_subject_id as external_subject_id,\n        history.association_date as association_date,\n        history.record_source as record_source,\n        row_number() over (partition by linked.library_id order by history.association_date desc) as rank\n    from linked\n        inner join history on linked.library_id = history.library_id and linked.external_subject_id = history.external_subject_id\n\n),\n\ntransformed as (\n\n    select\n        library_external_subject_hk,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        record_source,\n        encode(sha256(concat(\n            record_source,\n            library_id,\n            external_subject_id,\n            association_date\n        )::bytea), 'hex') as hash_diff,\n        library_id,\n        external_subject_id,\n        cast(association_date as timestamptz) as effective_from,\n        case\n            when (rank = 1) then\n                cast('9999-12-31' as date)\n            else\n                lag(association_date) over (partition by library_id order by rank)\n            end as effective_to,\n        case when (rank = 1) then 1 else 0 end as is_current\n    from\n        merged\n\n),\n\nfinal as (\n\n    select\n        cast(library_external_subject_hk as char(64)) as library_external_subject_hk,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(hash_diff as char(64)) as hash_diff,\n        cast(library_id as varchar(255)) as library_id,\n        cast(external_subject_id as varchar(255)) as external_subject_id,\n        cast(effective_from as timestamptz) as effective_from,\n        cast(effective_to as timestamptz) as effective_to,\n        cast(is_current as smallint) as is_current\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"effsat_library_external_subject\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.922633Z", "completed_at": "2025-04-09T12:57:17.925738Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.927883Z", "completed_at": "2025-04-09T12:57:17.927885Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010431051254272461, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.sat_library_sequencing_run_glims", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select\n        illumina_id as sequencing_run_id,\n        library_id,\n        record_source,\n        cast(\"timestamp\" as date) as \"timestamp\",\n        run,\n        override_cycles,\n        secondary_analysis,\n        number_fastqs,\n        fastq,\n        results,\n        notes,\n        trello\n    from\n        \"orcavault\".\"psa\".\"spreadsheet_google_lims\"\n\n),\n\ncleaned as (\n\n    select\n        row_number() over (partition by library_id, \"timestamp\" order by \"timestamp\" desc, sequencing_run_id desc) as rank,\n        sequencing_run_id,\n        trim(regexp_replace(library_id, E'[\\\\n\\\\r]+', '', 'g')) as library_id,\n        record_source,\n        \"timestamp\",\n        run,\n        trim(regexp_replace(override_cycles, E'[\\\\n\\\\r]+', '', 'g')) as override_cycles,\n        trim(regexp_replace(secondary_analysis, E'[\\\\n\\\\r]+', '', 'g')) as secondary_analysis,\n        trim(regexp_replace(number_fastqs, E'[\\\\n\\\\r]+', '', 'g')) as number_fastqs,\n        trim(regexp_replace(fastq, E'[\\\\n\\\\r]+', '', 'g')) as fastq,\n        trim(regexp_replace(results, E'[\\\\n\\\\r]+', '', 'g')) as results,\n        trim(regexp_replace(notes, E'[\\\\n\\\\r]+', '', 'g')) as notes,\n        trim(regexp_replace(trello, E'[\\\\n\\\\r]+', '', 'g')) as trello\n    from\n        source\n    where\n        (library_id is not null or library_id <> '') and\n        (sequencing_run_id is not null or sequencing_run_id <> '')\n\n),\n\ndifferentiated as (\n\n    select\n        *\n    from\n        cleaned\n    where\n        rank = 1\n    \n        and cast(\"timestamp\" as timestamptz) + time '11:00' > ( select coalesce(max(load_datetime), '1900-01-01') as ldts from \"orcavault\".\"dcl\".\"sat_library_sequencing_run_glims\" )\n    \n\n),\n\nencoded as (\n\n    select\n        encode(sha256(cast(sequencing_run_id as bytea)), 'hex') as sequencing_run_hk,\n        encode(sha256(cast(library_id as bytea)), 'hex') as library_hk,\n        record_source,\n        encode(sha256(concat(\"timestamp\", run, override_cycles, secondary_analysis, number_fastqs, fastq, results, notes, trello)::bytea), 'hex') as hash_diff,\n        \"timestamp\",\n        run,\n        override_cycles,\n        secondary_analysis,\n        number_fastqs,\n        fastq,\n        results,\n        notes,\n        trello\n    from\n        differentiated\n\n),\n\ntransformed as (\n\n    select\n        encode(sha256(concat(sequencing_run_hk, library_hk)::bytea), 'hex') as library_sequencing_run_hk,\n        cast(\"timestamp\" as timestamptz) + time '11:00' as load_datetime,\n        record_source,\n        hash_diff,\n        \"timestamp\",\n        run,\n        override_cycles,\n        secondary_analysis,\n        number_fastqs,\n        fastq,\n        results,\n        notes,\n        trello\n    from\n        encoded\n\n),\n\nfinal as (\n\n    select\n        cast(library_sequencing_run_hk as char(64)) as library_sequencing_run_hk,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(hash_diff as char(64)) as hash_diff,\n        cast(\"timestamp\" as date) as \"timestamp\",\n        cast(run as integer) as run,\n        cast(override_cycles as varchar(255)) as override_cycles,\n        cast(secondary_analysis as varchar(255)) as secondary_analysis,\n        cast(number_fastqs as varchar(255)) as number_fastqs,\n        cast(fastq as text) as fastq,\n        cast(results as text) as results,\n        cast(notes as text) as notes,\n        cast(trello as text) as trello\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"sat_library_sequencing_run_glims\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.925888Z", "completed_at": "2025-04-09T12:57:17.930798Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.931418Z", "completed_at": "2025-04-09T12:57:17.931421Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.006608009338378906, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.sat_library_sequencing_run_plims", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select\n        illumina_id as sequencing_run_id,\n        library_id,\n        cast(\"timestamp\" as date) as \"timestamp\",\n        run,\n        override_cycles,\n        secondary_analysis,\n        number_fastqs,\n        fastq,\n        results,\n        notes,\n        trello\n    from\n        \"orcavault\".\"ods\".\"data_portal_limsrow\"\n\n),\n\ncleaned as (\n\n    select\n        sequencing_run_id,\n        trim(regexp_replace(library_id, E'[\\\\n\\\\r]+', '', 'g')) as library_id,\n        \"timestamp\",\n        run,\n        trim(regexp_replace(override_cycles, E'[\\\\n\\\\r]+', '', 'g')) as override_cycles,\n        trim(regexp_replace(secondary_analysis, E'[\\\\n\\\\r]+', '', 'g')) as secondary_analysis,\n        trim(regexp_replace(number_fastqs, E'[\\\\n\\\\r]+', '', 'g')) as number_fastqs,\n        trim(regexp_replace(fastq, E'[\\\\n\\\\r]+', '', 'g')) as fastq,\n        trim(regexp_replace(results, E'[\\\\n\\\\r]+', '', 'g')) as results,\n        trim(regexp_replace(notes, E'[\\\\n\\\\r]+', '', 'g')) as notes,\n        trim(regexp_replace(trello, E'[\\\\n\\\\r]+', '', 'g')) as trello\n    from\n        source\n\n),\n\ndifferentiated as (\n\n    select\n        *\n    from\n        cleaned\n    \n    where\n        cast(\"timestamp\" as timestamptz) + time '11:00' > ( select coalesce(max(load_datetime), '1900-01-01') as ldts from \"orcavault\".\"dcl\".\"sat_library_sequencing_run_plims\" )\n    \n\n),\n\nencoded as (\n\n    select\n        encode(sha256(cast(sequencing_run_id as bytea)), 'hex') as sequencing_run_hk,\n        encode(sha256(cast(library_id as bytea)), 'hex') as library_hk,\n        encode(sha256(concat(\"timestamp\", run, override_cycles, secondary_analysis, number_fastqs, fastq, results, notes, trello)::bytea), 'hex') as hash_diff,\n        \"timestamp\",\n        run,\n        override_cycles,\n        secondary_analysis,\n        number_fastqs,\n        fastq,\n        results,\n        notes,\n        trello\n    from\n        differentiated\n\n),\n\ntransformed as (\n\n    select\n        encode(sha256(concat(sequencing_run_hk, library_hk)::bytea), 'hex') as library_sequencing_run_hk,\n        cast(\"timestamp\" as timestamptz) + time '11:00' as load_datetime,\n        (select 'data_portal_limsrow') as record_source,\n        hash_diff,\n        \"timestamp\",\n        run,\n        override_cycles,\n        secondary_analysis,\n        number_fastqs,\n        fastq,\n        results,\n        notes,\n        trello\n    from\n        encoded\n\n),\n\nfinal as (\n\n    select\n        cast(library_sequencing_run_hk as char(64)) as library_sequencing_run_hk,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(hash_diff as char(64)) as hash_diff,\n        cast(\"timestamp\" as date) as \"timestamp\",\n        cast(run as integer) as run,\n        cast(override_cycles as varchar(255)) as override_cycles,\n        cast(secondary_analysis as varchar(255)) as secondary_analysis,\n        cast(number_fastqs as varchar(255)) as number_fastqs,\n        cast(fastq as text) as fastq,\n        cast(results as text) as results,\n        cast(notes as text) as notes,\n        cast(trello as text) as trello\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"sat_library_sequencing_run_plims\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.928345Z", "completed_at": "2025-04-09T12:57:17.931270Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.938590Z", "completed_at": "2025-04-09T12:57:17.938593Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.01306295394897461, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.sat_library_sequencing_run_srm", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select\n        seq.instrument_run_id as sequencing_run_id,\n        assoc.library_id as library_id,\n        assoc.orcabus_id as orcabus_id,\n        assoc.association_date as association_date,\n        assoc.status as status\n    from \"orcavault\".\"ods\".\"sequence_run_manager_sequence\" seq\n        join \"orcavault\".\"ods\".\"sequence_run_manager_libraryassociation\" assoc on assoc.sequence_id = seq.orcabus_id\n    \n    where\n        cast(assoc.association_date as timestamptz) > ( select coalesce(max(load_datetime), '1900-01-01') as ldts from \"orcavault\".\"dcl\".\"sat_library_sequencing_run_srm\" )\n    \n\n),\n\ntransformed as (\n\n    select\n        encode(sha256(cast(sequencing_run_id as bytea)), 'hex') as sequencing_run_hk,\n        encode(sha256(cast(library_id as bytea)), 'hex') as library_hk,\n        cast('2025-04-09 12:57:16.592799+00:00' as timestamptz) as load_datetime,\n        (select 'sequence_run_manager_libraryassociation') as record_source,\n        encode(sha256(concat(\n            orcabus_id,\n            association_date,\n            status\n        )::bytea), 'hex') as hash_diff,\n        orcabus_id,\n        association_date,\n        status\n    from\n        source\n\n),\n\nfinal as (\n\n    select\n        cast(encode(sha256(concat(sequencing_run_hk, library_hk)::bytea), 'hex') as char(64)) as library_sequencing_run_hk,\n        cast(load_datetime as timestamptz) as load_datetime,\n        cast(record_source as varchar(255)) as record_source,\n        cast(hash_diff as char(64)) as hash_diff,\n        cast(orcabus_id as char(26)) as orcabus_id,\n        cast(association_date as timestamptz) as association_date,\n        cast(status as varchar(255)) as status\n    from\n        transformed\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"dcl\".\"sat_library_sequencing_run_srm\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.933771Z", "completed_at": "2025-04-09T12:57:17.943920Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.944101Z", "completed_at": "2025-04-09T12:57:17.944104Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.013525962829589844, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.grimmond_lims", "compiled": true, "compiled_code": "\n\nwith transformed as (\n\n    select\n\n        sqr.sequencing_run_id as sequencing_run_id,\n        cast((regexp_match(sqr.sequencing_run_id, '(?:^)(\\d{6})(?:_A\\d{5}_\\d{4}_[A-Z0-9]{10})'))[1] as date) as sequencing_run_date,\n        lib.library_id as library_id,\n        int_sbj.internal_subject_id as internal_subject_id,\n        ext_sbj.external_subject_id as external_subject_id,\n        smp.sample_id as sample_id,\n        ext_smp.external_sample_id as external_sample_id,\n        expr.experiment_id as experiment_id,\n        prj.project_id as project_id,\n        owner.owner_id as owner_id,\n        coalesce(sat.workflow, sat2.workflow) as workflow,\n        coalesce(sat.phenotype, sat2.phenotype) as phenotype,\n        coalesce(sat.type, sat2.type) as type,\n        coalesce(sat.assay, sat2.assay) as assay,\n        coalesce(sat.quality, sat2.quality) as quality,\n        sat.source as source,\n        sat.truseq_index as truseq_index,\n        coalesce(sat.load_datetime, sat2.load_datetime) as load_datetime\n\n    from\n\n        \"orcavault\".\"dcl\".\"hub_library\" lib\n\n            left join \"orcavault\".\"dcl\".\"link_library_sequencing_run\" lnk1 on lib.library_hk = lnk1.library_hk\n            left join \"orcavault\".\"dcl\".\"hub_sequencing_run\" sqr on lnk1.sequencing_run_hk = sqr.sequencing_run_hk\n\n            left join \"orcavault\".\"dcl\".\"link_library_internal_subject\" lnk2 on lib.library_hk = lnk2.library_hk\n            left join \"orcavault\".\"dcl\".\"hub_internal_subject\" int_sbj on lnk2.internal_subject_hk = int_sbj.internal_subject_hk\n\n            left join \"orcavault\".\"dcl\".\"link_library_external_subject\" lnk3 on lib.library_hk = lnk3.library_hk\n            left join \"orcavault\".\"dcl\".\"hub_external_subject\" ext_sbj on lnk3.external_subject_hk = ext_sbj.external_subject_hk\n\n            left join \"orcavault\".\"dcl\".\"link_library_sample\" lnk4 on lib.library_hk = lnk4.library_hk\n            left join \"orcavault\".\"dcl\".\"hub_sample\" smp on lnk4.sample_hk = smp.sample_hk\n\n            left join \"orcavault\".\"dcl\".\"link_library_external_sample\" lnk5 on lib.library_hk = lnk5.library_hk\n            left join \"orcavault\".\"dcl\".\"hub_external_sample\" ext_smp on lnk5.external_sample_hk = ext_smp.external_sample_hk\n\n            left join \"orcavault\".\"dcl\".\"link_library_experiment\" lnk6 on lib.library_hk = lnk6.library_hk\n            left join \"orcavault\".\"dcl\".\"hub_experiment\" expr on lnk6.experiment_hk = expr.experiment_hk\n\n            left join \"orcavault\".\"dcl\".\"link_library_project\" lnk7 on lib.library_hk = lnk7.library_hk\n            left join \"orcavault\".\"dcl\".\"hub_project\" prj on lnk7.project_hk = prj.project_hk\n\n            left join \"orcavault\".\"dcl\".\"link_library_ownership\" lnk8 on lib.library_hk = lnk8.library_hk\n            left join \"orcavault\".\"dcl\".\"hub_owner\" owner on lnk8.owner_hk = owner.owner_hk\n\n            left join \"orcavault\".\"dcl\".\"sat_library_glab\" sat on lib.library_hk = sat.library_hk\n            left join \"orcavault\".\"dcl\".\"sat_library_mm\" sat2 on lib.library_hk = sat2.library_hk\n\n),\n\nfiltered as (\n\n    select\n        *\n    from\n        transformed\n    where\n        project_id in ('PDAC-HMF')\n        or\n        (\n            owner_id = 'Grimmond'\n            and project_id in (\n                select\n                    distinct prj.project_id\n                from\n                    \"orcavault\".\"dcl\".\"hub_project\" prj\n                        join \"orcavault\".\"dcl\".\"link_project_ownership\" lnk on prj.project_hk = lnk.project_hk\n                        join \"orcavault\".\"dcl\".\"hub_owner\" owner on lnk.owner_hk = owner.owner_hk\n                where\n                    owner.owner_id = 'Grimmond'\n            )\n        )\n\n),\n\nfinal as (\n\n    select\n        cast(sequencing_run_id as varchar(255)) as sequencing_run_id,\n        cast(sequencing_run_date as date) as sequencing_run_date,\n        cast(library_id as varchar(255)) as library_id,\n        cast(internal_subject_id as varchar(255)) as internal_subject_id,\n        cast(external_subject_id as varchar(255)) as external_subject_id,\n        cast(sample_id as varchar(255)) as sample_id,\n        cast(external_sample_id as varchar(255)) as external_sample_id,\n        cast(experiment_id as varchar(255)) as experiment_id,\n        cast(project_id as varchar(255)) as project_id,\n        cast(owner_id as varchar(255)) as owner_id,\n        cast(workflow as varchar(255)) as workflow,\n        cast(phenotype as varchar(255)) as phenotype,\n        cast(type as varchar(255)) as type,\n        cast(assay as varchar(255)) as assay,\n        cast(quality as varchar(255)) as quality,\n        cast(source as varchar(255)) as source,\n        cast(truseq_index as varchar(255)) as truseq_index,\n        cast(load_datetime as timestamptz) as load_datetime\n    from\n        filtered\n    order by sequencing_run_date desc nulls last, library_id desc\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"mart\".\"grimmond_lims\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.931705Z", "completed_at": "2025-04-09T12:57:17.944375Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.944584Z", "completed_at": "2025-04-09T12:57:17.944586Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.014204978942871094, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.workflow", "compiled": true, "compiled_code": "\n\nwith linked as (\n\n    select distinct\n        hw.portal_run_id as portal_run_id,\n        hl.library_id as library_id\n    from \"orcavault\".\"dcl\".\"hub_workflow_run\" hw\n        full join \"orcavault\".\"dcl\".\"link_library_workflow_run\" lnk on lnk.workflow_run_hk = hw.workflow_run_hk\n        full join \"orcavault\".\"dcl\".\"hub_library\" hl on lnk.library_hk = hl.library_hk\n\n),\n\nranked as (\n\n    select\n        workflow_run_hk,\n        workflow_name,\n        workflow_version,\n        state_timestamp,\n        state_status,\n        row_number() over (partition by workflow_run_hk order by state_timestamp desc) as rank\n    from \"orcavault\".\"dcl\".\"sat_workflow_run_detail\"\n\n),\n\ndetailed as (\n\n    select * from ranked where rank = 1\n\n),\n\nmerged as (\n\n    \n\n    select\n        hub.portal_run_id as portal_run_id,\n        case\n            when sat.workflow_name is null then\n                ptl.type_name\n            else\n                sat.workflow_name\n            end as workflow_name,\n        case\n            when sat.state_status is null then\n                ptl.end_status\n            else\n                sat.state_status\n            end as workflow_status,\n        case\n            when sat.workflow_version is null then\n                ptl.version\n            else\n                sat.workflow_version\n            end as workflow_version\n    from \"orcavault\".\"dcl\".\"hub_workflow_run\" hub\n        full join detailed sat on sat.workflow_run_hk = hub.workflow_run_hk\n        full join \"orcavault\".\"dcl\".\"sat_workflow_run_portal\" ptl on ptl.workflow_run_hk = hub.workflow_run_hk\n\n),\n\ntransformed as (\n\n    select\n        merged.portal_run_id as portal_run_id,\n        merged.workflow_name as workflow_name,\n        merged.workflow_version as workflow_version,\n        merged.workflow_status as workflow_status,\n        linked.library_id as library_id\n    from\n        merged\n            join linked on linked.portal_run_id = merged.portal_run_id\n\n),\n\nfinal as (\n\n    select\n        cast(portal_run_id as char(16)) as portal_run_id,\n        cast(library_id as varchar(255)) as library_id,\n        cast(workflow_name as varchar(255)) as workflow_name,\n        cast(workflow_version as varchar(255)) as workflow_version,\n        cast(workflow_status as varchar(255)) as workflow_status\n    from\n        transformed\n    order by portal_run_id desc nulls last, library_id desc\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"mart\".\"workflow\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.939451Z", "completed_at": "2025-04-09T12:57:17.944839Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.945023Z", "completed_at": "2025-04-09T12:57:17.945025Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.005928993225097656, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.lims", "compiled": true, "compiled_code": "\n\nwith effective_sequencing_run as (\n\n    \n\n    select distinct\n        hub.sequencing_run_hk,\n        hub.sequencing_run_id,\n        sat.status\n    from \"orcavault\".\"dcl\".\"hub_sequencing_run\" hub\n        left join \"orcavault\".\"dcl\".\"sat_sequencing_run_detail\" sat on hub.sequencing_run_hk = sat.sequencing_run_hk\n    where\n        sat.status = 'SUCCEEDED' or sat.status is null\n\n),\n\neffsat_library_external_subject as (\n\n    select\n        lnk.*\n    from \"orcavault\".\"dcl\".\"link_library_external_subject\" lnk\n        join \"orcavault\".\"dcl\".\"effsat_library_external_subject\" effsat on effsat.library_external_subject_hk = lnk.library_external_subject_hk\n    where\n        effsat.is_current = 1\n\n),\n\neffective_link_library_experiment as (\n\n    select\n        lnk.*\n    from \"orcavault\".\"dcl\".\"link_library_experiment\" lnk\n        join \"orcavault\".\"dcl\".\"effsat_library_experiment\" effsat on effsat.library_experiment_hk = lnk.library_experiment_hk\n    where\n        effsat.is_current = 1\n\n),\n\neffective_sat_library as (\n\n    select\n        *,\n        row_number() over (partition by library_hk order by load_datetime desc) as rank\n    from \"orcavault\".\"dcl\".\"sat_library_glab\"\n\n),\n\ntransformed as (\n\n    select\n\n        sqr.sequencing_run_id as sequencing_run_id,\n        cast((regexp_match(sqr.sequencing_run_id, '(?:^)(\\d{6})(?:_A\\d{5}_\\d{4}_[A-Z0-9]{10})'))[1] as date) as sequencing_run_date,\n        lib.library_id as library_id,\n        int_sbj.internal_subject_id as internal_subject_id,\n        ext_sbj.external_subject_id as external_subject_id,\n        smp.sample_id as sample_id,\n        ext_smp.external_sample_id as external_sample_id,\n        expr.experiment_id as experiment_id,\n        prj.project_id as project_id,\n        owner.owner_id as owner_id,\n        sat.workflow as workflow,\n        sat.phenotype as phenotype,\n        sat.type as type,\n        sat.assay as assay,\n        sat.quality as quality,\n        sat.source as source,\n        sat.truseq_index as truseq_index,\n        sat.load_datetime as load_datetime\n\n    from\n\n        \"orcavault\".\"dcl\".\"hub_library\" lib\n\n            left join \"orcavault\".\"dcl\".\"link_library_sequencing_run\" lnk1 on lib.library_hk = lnk1.library_hk\n            left join effective_sequencing_run sqr on lnk1.sequencing_run_hk = sqr.sequencing_run_hk\n\n            left join \"orcavault\".\"dcl\".\"link_library_internal_subject\" lnk2 on lib.library_hk = lnk2.library_hk\n            left join \"orcavault\".\"dcl\".\"hub_internal_subject\" int_sbj on lnk2.internal_subject_hk = int_sbj.internal_subject_hk\n\n            left join effsat_library_external_subject lnk3 on lib.library_hk = lnk3.library_hk\n            left join \"orcavault\".\"dcl\".\"hub_external_subject\" ext_sbj on lnk3.external_subject_hk = ext_sbj.external_subject_hk\n\n            left join \"orcavault\".\"dcl\".\"link_library_sample\" lnk4 on lib.library_hk = lnk4.library_hk\n            left join \"orcavault\".\"dcl\".\"hub_sample\" smp on lnk4.sample_hk = smp.sample_hk\n\n            left join \"orcavault\".\"dcl\".\"link_library_external_sample\" lnk5 on lib.library_hk = lnk5.library_hk\n            left join \"orcavault\".\"dcl\".\"hub_external_sample\" ext_smp on lnk5.external_sample_hk = ext_smp.external_sample_hk\n\n            left join effective_link_library_experiment lnk6 on lib.library_hk = lnk6.library_hk\n            left join \"orcavault\".\"dcl\".\"hub_experiment\" expr on lnk6.experiment_hk = expr.experiment_hk\n\n            left join \"orcavault\".\"dcl\".\"link_library_project\" lnk7 on lib.library_hk = lnk7.library_hk\n            left join \"orcavault\".\"dcl\".\"hub_project\" prj on lnk7.project_hk = prj.project_hk\n\n            left join \"orcavault\".\"dcl\".\"link_library_ownership\" lnk8 on lib.library_hk = lnk8.library_hk\n            left join \"orcavault\".\"dcl\".\"hub_owner\" owner on lnk8.owner_hk = owner.owner_hk\n\n            left join effective_sat_library sat on lib.library_hk = sat.library_hk and sat.rank = 1\n\n),\n\nfinal as (\n\n    select\n        cast(sequencing_run_id as varchar(255)) as sequencing_run_id,\n        cast(sequencing_run_date as date) as sequencing_run_date,\n        cast(library_id as varchar(255)) as library_id,\n        cast(internal_subject_id as varchar(255)) as internal_subject_id,\n        cast(external_subject_id as varchar(255)) as external_subject_id,\n        cast(sample_id as varchar(255)) as sample_id,\n        cast(external_sample_id as varchar(255)) as external_sample_id,\n        cast(experiment_id as varchar(255)) as experiment_id,\n        cast(project_id as varchar(255)) as project_id,\n        cast(owner_id as varchar(255)) as owner_id,\n        cast(workflow as varchar(255)) as workflow,\n        cast(phenotype as varchar(255)) as phenotype,\n        cast(type as varchar(255)) as type,\n        cast(assay as varchar(255)) as assay,\n        cast(quality as varchar(255)) as quality,\n        cast(source as varchar(255)) as source,\n        cast(truseq_index as varchar(255)) as truseq_index,\n        cast(load_datetime as timestamptz) as load_datetime\n    from\n        transformed\n    where\n        sequencing_run_id is not null\n    order by sequencing_run_date desc nulls last, library_id desc\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"mart\".\"lims\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.946808Z", "completed_at": "2025-04-09T12:57:17.955780Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.956246Z", "completed_at": "2025-04-09T12:57:17.956248Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.010421037673950195, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.tothill_lims", "compiled": true, "compiled_code": "\n\nwith transformed as (\n\n    select\n        *\n    from\n        \"orcavault\".\"mart\".\"lims\"\n    where\n        owner_id = 'Tothill'\n        and project_id in (\n            select\n                distinct prj.project_id\n            from\n                \"orcavault\".\"dcl\".\"hub_project\" prj\n                    join \"orcavault\".\"dcl\".\"link_project_ownership\" lnk on prj.project_hk = lnk.project_hk\n                    join \"orcavault\".\"dcl\".\"hub_owner\" owner on lnk.owner_hk = owner.owner_hk\n            where\n                owner.owner_id = 'Tothill'\n        )\n\n),\n\nfinal as (\n\n    select\n        cast(sequencing_run_id as varchar(255)) as sequencing_run_id,\n        cast(sequencing_run_date as date) as sequencing_run_date,\n        cast(library_id as varchar(255)) as library_id,\n        cast(internal_subject_id as varchar(255)) as internal_subject_id,\n        cast(external_subject_id as varchar(255)) as external_subject_id,\n        cast(sample_id as varchar(255)) as sample_id,\n        cast(external_sample_id as varchar(255)) as external_sample_id,\n        cast(experiment_id as varchar(255)) as experiment_id,\n        cast(project_id as varchar(255)) as project_id,\n        cast(owner_id as varchar(255)) as owner_id,\n        cast(workflow as varchar(255)) as workflow,\n        cast(phenotype as varchar(255)) as phenotype,\n        cast(type as varchar(255)) as type,\n        cast(assay as varchar(255)) as assay,\n        cast(quality as varchar(255)) as quality,\n        cast(source as varchar(255)) as source,\n        cast(truseq_index as varchar(255)) as truseq_index,\n        cast(load_datetime as timestamptz) as load_datetime\n    from\n        transformed\n    order by sequencing_run_date desc nulls last, library_id desc\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"mart\".\"tothill_lims\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.952831Z", "completed_at": "2025-04-09T12:57:17.955939Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.956505Z", "completed_at": "2025-04-09T12:57:17.956508Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.010318756103515625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.curation_lims", "compiled": true, "compiled_code": "\n\nwith transformed as (\n\n    select\n        *\n    from\n        \"orcavault\".\"mart\".\"lims\"\n    where\n        sequencing_run_id is not null\n        and type is not null\n        and type not in ('10X', 'BiModal', 'exome', 'Exome', 'MeDIP', 'Metagenm', 'MethylSeq')\n        and assay is not null\n        and assay not like '%10X%'\n        and assay not in ('BM-5L', 'BM-6L', 'CRISPR', 'MeDIP', 'Takara')\n        and workflow in ('research', 'clinical', 'control', 'manual')\n),\n\nfinal as (\n\n    select\n        cast(sequencing_run_id as varchar(255)) as sequencing_run_id,\n        cast(sequencing_run_date as date) as sequencing_run_date,\n        cast(library_id as varchar(255)) as library_id,\n        cast(internal_subject_id as varchar(255)) as internal_subject_id,\n        cast(external_subject_id as varchar(255)) as external_subject_id,\n        cast(sample_id as varchar(255)) as sample_id,\n        cast(external_sample_id as varchar(255)) as external_sample_id,\n        cast(experiment_id as varchar(255)) as experiment_id,\n        cast(project_id as varchar(255)) as project_id,\n        cast(owner_id as varchar(255)) as owner_id,\n        cast(workflow as varchar(255)) as workflow,\n        cast(phenotype as varchar(255)) as phenotype,\n        cast(type as varchar(255)) as type,\n        cast(assay as varchar(255)) as assay,\n        cast(quality as varchar(255)) as quality,\n        cast(source as varchar(255)) as source,\n        cast(truseq_index as varchar(255)) as truseq_index,\n        cast(load_datetime as timestamptz) as load_datetime\n    from\n        transformed\n    order by sequencing_run_date desc nulls last, library_id desc\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"mart\".\"curation_lims\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.949645Z", "completed_at": "2025-04-09T12:57:17.956104Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.956747Z", "completed_at": "2025-04-09T12:57:17.956749Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010725259780883789, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.dawson_lims", "compiled": true, "compiled_code": "\n\nwith transformed as (\n\n    select\n        *\n    from\n        \"orcavault\".\"mart\".\"lims\"\n    where\n        owner_id = 'Dawson'\n        and project_id in (\n            select\n                distinct prj.project_id\n            from\n                \"orcavault\".\"dcl\".\"hub_project\" prj\n                    join \"orcavault\".\"dcl\".\"link_project_ownership\" lnk on prj.project_hk = lnk.project_hk\n                    join \"orcavault\".\"dcl\".\"hub_owner\" owner on lnk.owner_hk = owner.owner_hk\n            where\n                owner.owner_id = 'Dawson'\n        )\n\n),\n\nfinal as (\n\n    select\n        cast(sequencing_run_id as varchar(255)) as sequencing_run_id,\n        cast(sequencing_run_date as date) as sequencing_run_date,\n        cast(library_id as varchar(255)) as library_id,\n        cast(internal_subject_id as varchar(255)) as internal_subject_id,\n        cast(external_subject_id as varchar(255)) as external_subject_id,\n        cast(sample_id as varchar(255)) as sample_id,\n        cast(external_sample_id as varchar(255)) as external_sample_id,\n        cast(experiment_id as varchar(255)) as experiment_id,\n        cast(project_id as varchar(255)) as project_id,\n        cast(owner_id as varchar(255)) as owner_id,\n        cast(workflow as varchar(255)) as workflow,\n        cast(phenotype as varchar(255)) as phenotype,\n        cast(type as varchar(255)) as type,\n        cast(assay as varchar(255)) as assay,\n        cast(quality as varchar(255)) as quality,\n        cast(source as varchar(255)) as source,\n        cast(truseq_index as varchar(255)) as truseq_index,\n        cast(load_datetime as timestamptz) as load_datetime\n    from\n        transformed\n    order by sequencing_run_date desc nulls last, library_id desc\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"mart\".\"dawson_lims\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.957729Z", "completed_at": "2025-04-09T12:57:17.962733Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.962912Z", "completed_at": "2025-04-09T12:57:17.962914Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.005697965621948242, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.tothill_fastq", "compiled": true, "compiled_code": "\n\nwith transformed as (\n\n    select\n        lims.sequencing_run_id as sequencing_run_id,\n        fq.sequencing_run_date as sequencing_run_date,\n        fq.portal_run_id,\n        fq.bucket as bucket,\n        fq.key as \"key\",\n        lims.library_id as library_id,\n        fq.filename as filename,\n        fq.format as format,\n        fq.size as \"size\",\n        fq.storage_class as storage_class,\n        fq.e_tag as e_tag,\n        fq.last_modified_date as last_modified_date\n    from \"orcavault\".\"mart\".\"fastq\" fq\n        join \"orcavault\".\"mart\".\"tothill_lims\" lims on lims.library_id = fq.library_id and lims.sequencing_run_id = fq.sequencing_run_id\n\n),\n\nfinal as (\n\n    select\n        cast(sequencing_run_id as varchar(255)) as sequencing_run_id,\n        cast(sequencing_run_date as date) as sequencing_run_date,\n        cast(portal_run_id as varchar(255)) as portal_run_id,\n        cast(bucket as varchar(255)) as bucket,\n        cast(\"key\" as text) as \"key\",\n        cast(library_id as varchar(255)) as library_id,\n        cast(filename as text) as filename,\n        cast(format as varchar(255)) as format,\n        cast(\"size\" as bigint) as \"size\",\n        cast(storage_class as varchar(255)) as storage_class,\n        cast(e_tag as varchar(255)) as e_tag,\n        cast(last_modified_date as timestamptz) as last_modified_date\n    from\n        transformed\n    order by sequencing_run_date desc nulls last, library_id desc\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"mart\".\"tothill_fastq\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-09T12:57:17.960468Z", "completed_at": "2025-04-09T12:57:17.963207Z"}, {"name": "execute", "started_at": "2025-04-09T12:57:17.963379Z", "completed_at": "2025-04-09T12:57:17.963382Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.0032949447631835938, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.orcavault.dawson_fastq", "compiled": true, "compiled_code": "\n\nwith transformed as (\n\n    select\n        lims.sequencing_run_id as sequencing_run_id,\n        fq.sequencing_run_date as sequencing_run_date,\n        fq.portal_run_id,\n        fq.bucket as bucket,\n        fq.key as \"key\",\n        lims.library_id as library_id,\n        fq.filename as filename,\n        fq.format as format,\n        fq.size as \"size\",\n        fq.storage_class as storage_class,\n        fq.e_tag as e_tag,\n        fq.last_modified_date as last_modified_date\n    from \"orcavault\".\"mart\".\"fastq\" fq\n        join \"orcavault\".\"mart\".\"dawson_lims\" lims on lims.library_id = fq.library_id and lims.sequencing_run_id = fq.sequencing_run_id\n\n),\n\nfinal as (\n\n    select\n        cast(sequencing_run_id as varchar(255)) as sequencing_run_id,\n        cast(sequencing_run_date as date) as sequencing_run_date,\n        cast(portal_run_id as varchar(255)) as portal_run_id,\n        cast(bucket as varchar(255)) as bucket,\n        cast(\"key\" as text) as \"key\",\n        cast(library_id as varchar(255)) as library_id,\n        cast(filename as text) as filename,\n        cast(format as varchar(255)) as format,\n        cast(\"size\" as bigint) as \"size\",\n        cast(storage_class as varchar(255)) as storage_class,\n        cast(e_tag as varchar(255)) as e_tag,\n        cast(last_modified_date as timestamptz) as last_modified_date\n    from\n        transformed\n    order by sequencing_run_date desc nulls last, library_id desc\n\n)\n\nselect * from final", "relation_name": "\"orcavault\".\"mart\".\"dawson_fastq\"", "batch_results": null}], "elapsed_time": 0.3266780376434326, "args": {"log_format": "default", "skip_nodes_if_on_run_start_fails": false, "static": false, "print": true, "send_anonymous_usage_stats": true, "cache_selected_only": false, "state_modified_compare_vars": false, "log_level_file": "debug", "warn_error_options": {"include": [], "exclude": []}, "require_batched_execution_for_custom_microbatch_strategy": false, "quiet": false, "require_explicit_package_overrides_for_builtin_materializations": true, "empty_catalog": false, "printer_width": 80, "partial_parse": true, "exclude": [], "introspect": true, "log_format_file": "debug", "select": [], "strict_mode": false, "favor_state": false, "use_colors": true, "invocation_command": "dbt docs generate", "profiles_dir": "/Users/sklin/Projects/umccr/warehouse/orcahouse/orcavault", "log_level": "info", "write_json": true, "log_file_max_bytes": 10485760, "vars": {}, "log_path": "/Users/sklin/Projects/umccr/warehouse/orcahouse/orcavault/logs", "state_modified_compare_more_unrendered_values": false, "source_freshness_run_project_hooks": false, "which": "generate", "partial_parse_file_diff": true, "macro_debugging": false, "populate_cache": true, "require_nested_cumulative_type_params": false, "indirect_selection": "eager", "static_parser": true, "defer": false, "require_resource_names_without_spaces": false, "version_check": true, "compile": true, "show_resource_report": false, "project_dir": "/Users/sklin/Projects/umccr/warehouse/orcahouse/orcavault", "require_yaml_configuration_for_mf_time_spines": false, "use_colors_file": true}}